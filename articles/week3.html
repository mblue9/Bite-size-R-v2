<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Session 3 -- Data manipulation with dplyr • R4CancerSci</title>
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script><!-- Bootstrap --><link href="https://cdnjs.cloudflare.com/ajax/libs/bootswatch/3.4.0/flatly/bootstrap.min.css" rel="stylesheet" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="../bootstrap-toc.css">
<script src="../bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script><link href="../extra.css" rel="stylesheet">
<meta property="og:title" content="Session 3 -- Data manipulation with dplyr">
<meta property="og:description" content="R4CancerSci">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body data-spy="scroll" data-target="#toc">
    

    <div class="container template-article">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">R4CancerSci</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="">0.0.1</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" data-bs-toggle="dropdown" aria-expanded="false">
    Material
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="../articles/week0.html">Week 0 - Getting ready</a>
    </li>
    <li>
      <a href="../articles/week1.html">Week 1 - Introduction to RStudio</a>
    </li>
    <li>
      <a href="../articles/week2.html">Week 2 - Data visualization with ggplot2</a>
    </li>
    <li>
      <a href="../articles/week3.html">Week 3 - Data manipulation using dplyr</a>
    </li>
    <li>
      <a href="../articles/week4.html">Week 4 - Grouping, combining and restructuring data for analysis</a>
    </li>
  </ul>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right">
<li>
  <a href="https://github.com/pmacdasci/R4CancerSci" class="external-link">
    <span class="fa fa-github"></span>
     
  </a>
</li>
      </ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      

      </header><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header toc-ignore">
      <h1 data-toc-skip>Session 3 – Data manipulation with dplyr</h1>
            
      
      <small class="dont-index">Source: <a href="https://github.com/R4CancerSci/R4CancerSci/blob/HEAD/vignettes/week3.Rmd" class="external-link"><code>vignettes/week3.Rmd</code></a></small>
      <div class="hidden name"><code>week3.Rmd</code></div>

    </div>

    
    
<blockquote>
<h4 id="learning-objectives">Learning objectives</h4>
<ul>
<li>Recall the five key <strong>dplyr</strong> functions for
manipulating your data
<ul>
<li>
<strong><code><a href="https://dplyr.tidyverse.org/reference/select.html" class="external-link">select()</a></code></strong> for selecting a subset of
variables, i.e. selecting columns in your table</li>
<li>
<strong><code><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter()</a></code></strong> for selecting observations
based on their values, i.e. selecting rows in your table</li>
<li>
<strong><code><a href="https://dplyr.tidyverse.org/reference/arrange.html" class="external-link">arrange()</a></code></strong> for sorting the observations
in your table</li>
<li>
<strong><code><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate()</a></code></strong> for creating a new variable
or modifying an existing variable</li>
<li>
<strong><code><a href="https://dplyr.tidyverse.org/reference/summarise.html" class="external-link">summarise()</a></code></strong> for collapsing values in
one of more columns to a single summary value</li>
</ul>
</li>
<li>Chain operations together into a workflow using pipes</li>
<li>Review faceting in ggplot2 to split your data into separate
categories and create a series of sub-plots arranged in a grid</li>
</ul>
</blockquote>
<hr>
<div class="rmdblock">
<p>
A video that goes through this session’s material can be found <a href="https://www.youtube.com/watch?v=YHGi1iduQ18" class="external-link">here</a>.
</p>
</div>
<div class="section level2">
<h2 id="data-manipulation-with-dplyr">Data manipulation with dplyr<a class="anchor" aria-label="anchor" href="#data-manipulation-with-dplyr"></a>
</h2>
<p><strong>dplyr</strong> is one of the packages that gets loaded as
part of the tidyverse.</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://tidyverse.tidyverse.org" class="external-link">tidyverse</a></span><span class="op">)</span></code></pre></div>
<pre><code><span class="co">## ── <span style="font-weight: bold;">Attaching packages</span> ─────────────────────────────────────── tidyverse 1.3.1 ──</span></code></pre>
<pre><code><span class="co">## <span style="color: #00BB00;">✔</span> <span style="color: #0000BB;">ggplot2</span> 3.3.6     <span style="color: #00BB00;">✔</span> <span style="color: #0000BB;">purrr  </span> 0.3.4</span>
<span class="co">## <span style="color: #00BB00;">✔</span> <span style="color: #0000BB;">tibble </span> 3.1.7     <span style="color: #00BB00;">✔</span> <span style="color: #0000BB;">dplyr  </span> 1.0.9</span>
<span class="co">## <span style="color: #00BB00;">✔</span> <span style="color: #0000BB;">tidyr  </span> 1.2.0     <span style="color: #00BB00;">✔</span> <span style="color: #0000BB;">stringr</span> 1.4.0</span>
<span class="co">## <span style="color: #00BB00;">✔</span> <span style="color: #0000BB;">readr  </span> 2.1.2     <span style="color: #00BB00;">✔</span> <span style="color: #0000BB;">forcats</span> 0.5.1</span></code></pre>
<pre><code><span class="co">## ── <span style="font-weight: bold;">Conflicts</span> ────────────────────────────────────────── tidyverse_conflicts() ──</span>
<span class="co">## <span style="color: #BB0000;">✖</span> <span style="color: #0000BB;">dplyr</span>::<span style="color: #00BB00;">filter()</span> masks <span style="color: #0000BB;">stats</span>::filter()</span>
<span class="co">## <span style="color: #BB0000;">✖</span> <span style="color: #0000BB;">dplyr</span>::<span style="color: #00BB00;">lag()</span>    masks <span style="color: #0000BB;">stats</span>::lag()</span></code></pre>
<p>dplyr is the Swiss army knife in the tidyverse, providing many useful
functions for manipulating tabular data in data frames or tibbles. We’re
going to look at the key functions for filtering our data, modifying the
contents and computing summary statistics.</p>
<p>We’ll also use the pipe operator,
<strong><code>%&gt;%</code></strong>, for chaining operations together
into mini workflows in a way that makes for more readable and
maintainable code.</p>
<p>Finally, we’ll return to plotting and look at the powerful feature of
ggplot2, <strong>faceting</strong>, that allows you to divide your plots
into subplots by splitting the observations based on one or more
categorical variables.</p>
<p>We’ll again use the METABRIC data set to illustrate how these
operations work.</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">metabric</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://readr.tidyverse.org/reference/read_delim.html" class="external-link">read_csv</a></span><span class="op">(</span><span class="st">"https://zenodo.org/record/6450144/files/metabric_clinical_and_expression_data.csv"</span><span class="op">)</span>
<span class="va">metabric</span></code></pre></div>
<pre><code><span class="co">## <span style="color: #949494;"># A tibble: 1,904 × 32</span></span>
<span class="co">##    Patient_ID Cohort Age_at_diagnosis Survival_time Survival_status Vital_status</span>
<span class="co">##    <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>       <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>            <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>         <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>           <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>       </span>
<span class="co">## <span style="color: #BCBCBC;"> 1</span> MB-0000         1             75.6         140.  LIVING          Living      </span>
<span class="co">## <span style="color: #BCBCBC;"> 2</span> MB-0002         1             43.2          84.6 LIVING          Living      </span>
<span class="co">## <span style="color: #BCBCBC;"> 3</span> MB-0005         1             48.9         164.  DECEASED        Died of Dis…</span>
<span class="co">## <span style="color: #BCBCBC;"> 4</span> MB-0006         1             47.7         165.  LIVING          Living      </span>
<span class="co">## <span style="color: #BCBCBC;"> 5</span> MB-0008         1             77.0          41.4 DECEASED        Died of Dis…</span>
<span class="co">## <span style="color: #BCBCBC;"> 6</span> MB-0010         1             78.8           7.8 DECEASED        Died of Dis…</span>
<span class="co">## <span style="color: #BCBCBC;"> 7</span> MB-0014         1             56.4         164.  LIVING          Living      </span>
<span class="co">## <span style="color: #BCBCBC;"> 8</span> MB-0022         1             89.1          99.5 DECEASED        Died of Oth…</span>
<span class="co">## <span style="color: #BCBCBC;"> 9</span> MB-0028         1             86.4          36.6 DECEASED        Died of Oth…</span>
<span class="co">## <span style="color: #BCBCBC;">10</span> MB-0035         1             84.2          36.3 DECEASED        Died of Dis…</span>
<span class="co">## <span style="color: #949494;"># … with 1,894 more rows, and 26 more variables: Chemotherapy &lt;chr&gt;,</span></span>
<span class="co">## <span style="color: #949494;">#   Radiotherapy &lt;chr&gt;, Tumour_size &lt;dbl&gt;, Tumour_stage &lt;dbl&gt;,</span></span>
<span class="co">## <span style="color: #949494;">#   Neoplasm_histologic_grade &lt;dbl&gt;, Lymph_nodes_examined_positive &lt;dbl&gt;,</span></span>
<span class="co">## <span style="color: #949494;">#   Lymph_node_status &lt;dbl&gt;, Cancer_type &lt;chr&gt;, ER_status &lt;chr&gt;,</span></span>
<span class="co">## <span style="color: #949494;">#   PR_status &lt;chr&gt;, HER2_status &lt;chr&gt;, HER2_status_measured_by_SNP6 &lt;chr&gt;,</span></span>
<span class="co">## <span style="color: #949494;">#   PAM50 &lt;chr&gt;, `3-gene_classifier` &lt;chr&gt;, Nottingham_prognostic_index &lt;dbl&gt;,</span></span>
<span class="co">## <span style="color: #949494;">#   Cellularity &lt;chr&gt;, Integrative_cluster &lt;chr&gt;, Mutation_count &lt;dbl&gt;, …</span></span></code></pre>
<hr>
</div>
<div class="section level2">
<h2 id="dplyr-verbs">dplyr verbs<a class="anchor" aria-label="anchor" href="#dplyr-verbs"></a>
</h2>
<p>We will be looking at the 5 key dplyr functions this session:</p>
<ul>
<li>
<strong><code><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter()</a></code></strong> for filtering rows</li>
<li>
<strong><code><a href="https://dplyr.tidyverse.org/reference/select.html" class="external-link">select()</a></code></strong> for selecting columns</li>
<li>
<strong><code><a href="https://dplyr.tidyverse.org/reference/arrange.html" class="external-link">arrange()</a></code></strong> for sorting rows</li>
<li>
<strong><code><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate()</a></code></strong> for modifying columns or
creating new ones</li>
<li>
<strong><code><a href="https://dplyr.tidyverse.org/reference/summarise.html" class="external-link">summarise()</a></code></strong> for computing summary
values</li>
</ul>
<p>In looking at each of these in turn, we’ll be applying these to the
entire data set. It is possible to combine these with the
<code><a href="https://dplyr.tidyverse.org/reference/group_by.html" class="external-link">group_by()</a></code> function to instead operate on separate groups
within our data set but this is something we’ll cover in detail next
session.</p>
<p>The dplyr operations are commonly referred to as “verbs” in a data
manipulation grammar. These verbs have a common syntax and work together
in a consistent and uniform manner. They all have the following shared
behaviours:</p>
<ul>
<li><p>The first argument in each function is a data frame (or
tibble)</p></li>
<li><p>Any additional arguments describe what operation to perform on
the data frame</p></li>
<li><p>Variable names, i.e. column names, are referred to without using
quotes</p></li>
<li><p>The result of an operation is a new data frame</p></li>
</ul>
<hr>
</div>
<div class="section level2">
<h2 id="filtering-rows-with-filter">Filtering rows with <code>filter()</code><a class="anchor" aria-label="anchor" href="#filtering-rows-with-filter"></a>
</h2>
<p>The <strong><code>filter</code></strong> verb allows you to choose
rows from a data frame that match some specified criteria. The criteria
are based on values of variables and can make use of comparison
operators such as <code>==</code>, <code>&gt;</code>, <code>&lt;</code>
and <code>!=</code>.</p>
<p>For example, to filter the METABRIC data set so that it only contains
observations for those patients who died of breast cancer we can use
<code><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter()</a></code> as follows.</p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">deceased</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="va">metabric</span>, <span class="va">Vital_status</span> <span class="op">==</span> <span class="st">"Died of Disease"</span><span class="op">)</span>
<span class="va">deceased</span></code></pre></div>
<pre><code><span class="co">## <span style="color: #949494;"># A tibble: 622 × 32</span></span>
<span class="co">##    Patient_ID Cohort Age_at_diagnosis Survival_time Survival_status Vital_status</span>
<span class="co">##    <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>       <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>            <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>         <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>           <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>       </span>
<span class="co">## <span style="color: #BCBCBC;"> 1</span> MB-0005         1             48.9        164.   DECEASED        Died of Dis…</span>
<span class="co">## <span style="color: #BCBCBC;"> 2</span> MB-0008         1             77.0         41.4  DECEASED        Died of Dis…</span>
<span class="co">## <span style="color: #BCBCBC;"> 3</span> MB-0010         1             78.8          7.8  DECEASED        Died of Dis…</span>
<span class="co">## <span style="color: #BCBCBC;"> 4</span> MB-0035         1             84.2         36.3  DECEASED        Died of Dis…</span>
<span class="co">## <span style="color: #BCBCBC;"> 5</span> MB-0036         1             85.5        132.   DECEASED        Died of Dis…</span>
<span class="co">## <span style="color: #BCBCBC;"> 6</span> MB-0079         1             50.4         28.5  DECEASED        Died of Dis…</span>
<span class="co">## <span style="color: #BCBCBC;"> 7</span> MB-0083         1             64.8         86.1  DECEASED        Died of Dis…</span>
<span class="co">## <span style="color: #BCBCBC;"> 8</span> MB-0100         1             68.7          8.07 DECEASED        Died of Dis…</span>
<span class="co">## <span style="color: #BCBCBC;"> 9</span> MB-0102         1             51.4        141.   DECEASED        Died of Dis…</span>
<span class="co">## <span style="color: #BCBCBC;">10</span> MB-0108         1             43.2         42.7  DECEASED        Died of Dis…</span>
<span class="co">## <span style="color: #949494;"># … with 612 more rows, and 26 more variables: Chemotherapy &lt;chr&gt;,</span></span>
<span class="co">## <span style="color: #949494;">#   Radiotherapy &lt;chr&gt;, Tumour_size &lt;dbl&gt;, Tumour_stage &lt;dbl&gt;,</span></span>
<span class="co">## <span style="color: #949494;">#   Neoplasm_histologic_grade &lt;dbl&gt;, Lymph_nodes_examined_positive &lt;dbl&gt;,</span></span>
<span class="co">## <span style="color: #949494;">#   Lymph_node_status &lt;dbl&gt;, Cancer_type &lt;chr&gt;, ER_status &lt;chr&gt;,</span></span>
<span class="co">## <span style="color: #949494;">#   PR_status &lt;chr&gt;, HER2_status &lt;chr&gt;, HER2_status_measured_by_SNP6 &lt;chr&gt;,</span></span>
<span class="co">## <span style="color: #949494;">#   PAM50 &lt;chr&gt;, `3-gene_classifier` &lt;chr&gt;, Nottingham_prognostic_index &lt;dbl&gt;,</span></span>
<span class="co">## <span style="color: #949494;">#   Cellularity &lt;chr&gt;, Integrative_cluster &lt;chr&gt;, Mutation_count &lt;dbl&gt;, …</span></span></code></pre>
<p>Remember that the <strong><code>==</code></strong> operator tests for
equality, i.e. is the value for <code>Vital_status</code> for each
patient (observation) equal to “Died of Disease”.</p>
<p>Let’s have a look at the various categories in the
<code>Vital_status</code> variable.</p>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/base/table.html" class="external-link">table</a></span><span class="op">(</span><span class="va">metabric</span><span class="op">$</span><span class="va">Vital_status</span><span class="op">)</span></code></pre></div>
<pre><code><span class="co">## </span>
<span class="co">##      Died of Disease Died of Other Causes               Living </span>
<span class="co">##                  622                  480                  801</span></code></pre>
<p>We could use the <code>!=</code> comparison operator to select all
deceased patients regardless of whether they died of the disease or
other causes, by filtering for those that don’t have the value
“Living”.</p>
<div class="sourceCode" id="cb11"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">deceased</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="va">metabric</span>, <span class="va">Vital_status</span> <span class="op">!=</span> <span class="st">"Living"</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">nrow</a></span><span class="op">(</span><span class="va">deceased</span><span class="op">)</span></code></pre></div>
<pre><code><span class="co">## [1] 1102</span></code></pre>
<p>Another way of doing this is to specify which classes we are
interested in and use the <strong><code>%in%</code></strong> operator to
test which observations (rows) contain those values.</p>
<div class="sourceCode" id="cb13"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">deceased</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="va">metabric</span>, <span class="va">Vital_status</span> <span class="op"><a href="https://rdrr.io/r/base/match.html" class="external-link">%in%</a></span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"Died of Disease"</span>, <span class="st">"Died of Other Causes"</span><span class="op">)</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">nrow</a></span><span class="op">(</span><span class="va">deceased</span><span class="op">)</span></code></pre></div>
<pre><code><span class="co">## [1] 1102</span></code></pre>
<p>Another of the tidyverse packages,
<strong><code>stringr</code></strong>, contains a set of very useful
functions for operating on text or character strings. One such function,
<strong><code><a href="https://stringr.tidyverse.org/reference/str_starts.html" class="external-link">str_starts()</a></code></strong> could be used to find all
<code>Vital_status</code> values that start with “Died”.</p>
<div class="sourceCode" id="cb15"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">deceased</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="va">metabric</span>, <span class="fu"><a href="https://stringr.tidyverse.org/reference/str_starts.html" class="external-link">str_starts</a></span><span class="op">(</span><span class="va">Vital_status</span>, <span class="st">"Died"</span><span class="op">)</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">nrow</a></span><span class="op">(</span><span class="va">deceased</span><span class="op">)</span></code></pre></div>
<pre><code><span class="co">## [1] 1102</span></code></pre>
<p>Unsurprisingly there is an equivalent function,
<code><a href="https://stringr.tidyverse.org/reference/str_starts.html" class="external-link">str_ends()</a></code>, for matching the end of text (character) values
and <code><a href="https://stringr.tidyverse.org/reference/str_detect.html" class="external-link">str_detect()</a></code> is another useful function that determines
whether values match a regular expression. Regular expressions are a
language for search patterns used frequently in computer programming and
really worth getting to grips with but sadly these are beyond the scope
of this course.</p>
<p>Filtering based on a logical variable is the most simple type of
filtering of all. We don’t have any logical variables in our METABRIC
data set so we’ll create one from the binary
<code>Survival_status</code> variable to use as an example.</p>
<div class="sourceCode" id="cb17"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># create a new logical variable called 'Deceased'</span>
<span class="va">metabric</span><span class="op">$</span><span class="va">Deceased</span> <span class="op">&lt;-</span> <span class="va">metabric</span><span class="op">$</span><span class="va">Survival_status</span> <span class="op">==</span> <span class="st">"DECEASED"</span>
<span class="co">#</span>
<span class="co"># filtering based on a logical variable - only selects TRUE values</span>
<span class="va">deceased</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="va">metabric</span>, <span class="va">Deceased</span><span class="op">)</span>
<span class="co">#</span>
<span class="co"># only display those columns we're interested in</span>
<span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html" class="external-link">select</a></span><span class="op">(</span><span class="va">deceased</span>, <span class="va">Patient_ID</span>, <span class="va">Survival_status</span>, <span class="va">Vital_status</span>, <span class="va">Deceased</span><span class="op">)</span></code></pre></div>
<pre><code><span class="co">## <span style="color: #949494;"># A tibble: 1,103 × 4</span></span>
<span class="co">##    Patient_ID Survival_status Vital_status         Deceased</span>
<span class="co">##    <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>      <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>           <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>                <span style="color: #949494; font-style: italic;">&lt;lgl&gt;</span>   </span>
<span class="co">## <span style="color: #BCBCBC;"> 1</span> MB-0005    DECEASED        Died of Disease      TRUE    </span>
<span class="co">## <span style="color: #BCBCBC;"> 2</span> MB-0008    DECEASED        Died of Disease      TRUE    </span>
<span class="co">## <span style="color: #BCBCBC;"> 3</span> MB-0010    DECEASED        Died of Disease      TRUE    </span>
<span class="co">## <span style="color: #BCBCBC;"> 4</span> MB-0022    DECEASED        Died of Other Causes TRUE    </span>
<span class="co">## <span style="color: #BCBCBC;"> 5</span> MB-0028    DECEASED        Died of Other Causes TRUE    </span>
<span class="co">## <span style="color: #BCBCBC;"> 6</span> MB-0035    DECEASED        Died of Disease      TRUE    </span>
<span class="co">## <span style="color: #BCBCBC;"> 7</span> MB-0036    DECEASED        Died of Disease      TRUE    </span>
<span class="co">## <span style="color: #BCBCBC;"> 8</span> MB-0046    DECEASED        Died of Other Causes TRUE    </span>
<span class="co">## <span style="color: #BCBCBC;"> 9</span> MB-0079    DECEASED        Died of Disease      TRUE    </span>
<span class="co">## <span style="color: #BCBCBC;">10</span> MB-0083    DECEASED        Died of Disease      TRUE    </span>
<span class="co">## <span style="color: #949494;"># … with 1,093 more rows</span></span></code></pre>
<p>We can use the <strong><code>!</code></strong> operator to filter
those patients who are not deceased.</p>
<div class="sourceCode" id="cb19"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="va">metabric</span>, <span class="op">!</span><span class="va">Deceased</span><span class="op">)</span></code></pre></div>
<p>The eagle-eyed will have spotted that filtering on our newly created
Deceased logical variable gave a slightly different number of
observations (patients) who are considered to be deceased, compared with
the filtering operations shown above based on the
<code>Vital_status</code> variable. We get one extra row. This is
because we have a missing value for the vital status of one of the
patients. We can filter for this using the
<strong><code><a href="https://rdrr.io/r/base/NA.html" class="external-link">is.na()</a></code></strong> function.</p>
<div class="sourceCode" id="cb20"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">missing_vital_status</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="va">metabric</span>, <span class="fu"><a href="https://rdrr.io/r/base/NA.html" class="external-link">is.na</a></span><span class="op">(</span><span class="va">Vital_status</span><span class="op">)</span><span class="op">)</span>

<span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html" class="external-link">select</a></span><span class="op">(</span><span class="va">missing_vital_status</span>, <span class="va">Patient_ID</span>, <span class="va">Survival_status</span>, <span class="va">Vital_status</span>, <span class="va">Deceased</span><span class="op">)</span></code></pre></div>
<pre><code><span class="co">## <span style="color: #949494;"># A tibble: 1 × 4</span></span>
<span class="co">##   Patient_ID Survival_status Vital_status Deceased</span>
<span class="co">##   <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>      <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>           <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>        <span style="color: #949494; font-style: italic;">&lt;lgl&gt;</span>   </span>
<span class="co">## <span style="color: #BCBCBC;">1</span> MB-5130    DECEASED        <span style="color: #BB0000;">NA</span>           TRUE</span></code></pre>
<p><code><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter()</a></code> only retains rows where the condition if
<code>TRUE</code>; both <code>FALSE</code> and <code>NA</code> values
are filtered out.</p>
<p>We can apply more than one condition in our filtering operation, for
example the patients who were still alive at the time of the METABRIC
study and had survived for more than 10 years (120 months).</p>
<div class="sourceCode" id="cb22"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="va">metabric</span>, <span class="va">Survival_status</span> <span class="op">==</span> <span class="st">"LIVING"</span>, <span class="va">Survival_time</span> <span class="op">&gt;</span> <span class="fl">120</span><span class="op">)</span></code></pre></div>
<pre><code><span class="co">## <span style="color: #949494;"># A tibble: 545 × 33</span></span>
<span class="co">##    Patient_ID Cohort Age_at_diagnosis Survival_time Survival_status Vital_status</span>
<span class="co">##    <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>       <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>            <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>         <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>           <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>       </span>
<span class="co">## <span style="color: #BCBCBC;"> 1</span> MB-0000         1             75.6          140. LIVING          Living      </span>
<span class="co">## <span style="color: #BCBCBC;"> 2</span> MB-0006         1             47.7          165. LIVING          Living      </span>
<span class="co">## <span style="color: #BCBCBC;"> 3</span> MB-0014         1             56.4          164. LIVING          Living      </span>
<span class="co">## <span style="color: #BCBCBC;"> 4</span> MB-0039         1             70.9          164. LIVING          Living      </span>
<span class="co">## <span style="color: #BCBCBC;"> 5</span> MB-0045         1             45.3          165. LIVING          Living      </span>
<span class="co">## <span style="color: #BCBCBC;"> 6</span> MB-0053         1             70.0          161. LIVING          Living      </span>
<span class="co">## <span style="color: #BCBCBC;"> 7</span> MB-0054         1             66.9          160. LIVING          Living      </span>
<span class="co">## <span style="color: #BCBCBC;"> 8</span> MB-0060         1             45.4          141. LIVING          Living      </span>
<span class="co">## <span style="color: #BCBCBC;"> 9</span> MB-0062         1             52.1          154. LIVING          Living      </span>
<span class="co">## <span style="color: #BCBCBC;">10</span> MB-0066         1             61.5          157. LIVING          Living      </span>
<span class="co">## <span style="color: #949494;"># … with 535 more rows, and 27 more variables: Chemotherapy &lt;chr&gt;,</span></span>
<span class="co">## <span style="color: #949494;">#   Radiotherapy &lt;chr&gt;, Tumour_size &lt;dbl&gt;, Tumour_stage &lt;dbl&gt;,</span></span>
<span class="co">## <span style="color: #949494;">#   Neoplasm_histologic_grade &lt;dbl&gt;, Lymph_nodes_examined_positive &lt;dbl&gt;,</span></span>
<span class="co">## <span style="color: #949494;">#   Lymph_node_status &lt;dbl&gt;, Cancer_type &lt;chr&gt;, ER_status &lt;chr&gt;,</span></span>
<span class="co">## <span style="color: #949494;">#   PR_status &lt;chr&gt;, HER2_status &lt;chr&gt;, HER2_status_measured_by_SNP6 &lt;chr&gt;,</span></span>
<span class="co">## <span style="color: #949494;">#   PAM50 &lt;chr&gt;, `3-gene_classifier` &lt;chr&gt;, Nottingham_prognostic_index &lt;dbl&gt;,</span></span>
<span class="co">## <span style="color: #949494;">#   Cellularity &lt;chr&gt;, Integrative_cluster &lt;chr&gt;, Mutation_count &lt;dbl&gt;, …</span></span></code></pre>
<p>We can add as many conditions as we like separating each with a
comma. Adding conditions in this way is equivalent to combining the
conditions using the <strong><code>&amp;</code></strong> (Boolean AND)
operator.</p>
<div class="sourceCode" id="cb24"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="va">metabric</span>, <span class="va">Survival_status</span> <span class="op">==</span> <span class="st">"LIVING"</span>, <span class="va">Survival_time</span> <span class="op">&gt;</span> <span class="fl">120</span><span class="op">)</span>
<span class="co"># is equivalent to</span>
<span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="va">metabric</span>, <span class="va">Survival_status</span> <span class="op">==</span> <span class="st">"LIVING"</span> <span class="op">&amp;</span> <span class="va">Survival_time</span> <span class="op">&gt;</span> <span class="fl">120</span><span class="op">)</span></code></pre></div>
<p>Naturally we can also check when either of two conditions holds true
by using the <strong><code>|</code></strong> (Boolean OR) operator. And
we can build up more complicated filtering operations using both
<code>&amp;</code> and <code>|</code>. For example, let’s see which
patients have stage 3 or stage 4 tumours that are either estrogen
receptor (ER) positive or progesterone receptor (PR) positive.</p>
<div class="sourceCode" id="cb25"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">selected_patients</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="va">metabric</span>, <span class="va">Tumour_stage</span> <span class="op">&gt;=</span> <span class="fl">3</span>, <span class="va">ER_status</span> <span class="op">==</span> <span class="st">"Positive"</span> <span class="op">|</span> <span class="va">PR_status</span> <span class="op">==</span> <span class="st">"Positive"</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">nrow</a></span><span class="op">(</span><span class="va">selected_patients</span><span class="op">)</span></code></pre></div>
<pre><code><span class="co">## [1] 79</span></code></pre>
<p>In this case, if you used <code>&amp;</code> in place of the comma
you’d need to be careful about the precedence of the <code>&amp;</code>
and <code>|</code> operators and use parentheses to make clear what you
intended.</p>
<div class="sourceCode" id="cb27"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="va">metabric</span>, <span class="va">Tumour_stage</span> <span class="op">&gt;=</span> <span class="fl">3</span> <span class="op">&amp;</span> <span class="op">(</span><span class="va">ER_status</span> <span class="op">==</span> <span class="st">"Positive"</span> <span class="op">|</span> <span class="va">PR_status</span> <span class="op">==</span> <span class="st">"Positive"</span><span class="op">)</span><span class="op">)</span></code></pre></div>
<hr>
</div>
<div class="section level2">
<h2 id="selecting-columns-with-select">Selecting columns with <code>select()</code><a class="anchor" aria-label="anchor" href="#selecting-columns-with-select"></a>
</h2>
<p>Another way of “slicing and dicing”” our tabular data set is to
select just the variables or columns we’re interested in. This can be
important particularly when the data set contains a very large number of
variables as is the case for the METABRIC data. Notice how when we print
the METABRIC data frame it is not possible to display all the columns;
we only get the first few and then a long list of the additional ones
that weren’t displayed.</p>
<p>Using the <code>$</code> operator is quite convenient for selecting a
single column and extracting the values as a vector. However, for
selecting multiple columns, the <strong><code><a href="https://dplyr.tidyverse.org/reference/select.html" class="external-link">select()</a></code></strong>
function from dplyr is simpler. We have already seen it a little when we
used it above to view just a few columns in the dataset.</p>
<div class="sourceCode" id="cb28"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html" class="external-link">select</a></span><span class="op">(</span><span class="va">metabric</span>, <span class="va">Patient_ID</span>, <span class="va">Survival_status</span>, <span class="va">Vital_status</span>, <span class="va">Deceased</span><span class="op">)</span></code></pre></div>
<pre><code><span class="co">## <span style="color: #949494;"># A tibble: 1,904 × 4</span></span>
<span class="co">##    Patient_ID Survival_status Vital_status         Deceased</span>
<span class="co">##    <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>      <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>           <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>                <span style="color: #949494; font-style: italic;">&lt;lgl&gt;</span>   </span>
<span class="co">## <span style="color: #BCBCBC;"> 1</span> MB-0000    LIVING          Living               FALSE   </span>
<span class="co">## <span style="color: #BCBCBC;"> 2</span> MB-0002    LIVING          Living               FALSE   </span>
<span class="co">## <span style="color: #BCBCBC;"> 3</span> MB-0005    DECEASED        Died of Disease      TRUE    </span>
<span class="co">## <span style="color: #BCBCBC;"> 4</span> MB-0006    LIVING          Living               FALSE   </span>
<span class="co">## <span style="color: #BCBCBC;"> 5</span> MB-0008    DECEASED        Died of Disease      TRUE    </span>
<span class="co">## <span style="color: #BCBCBC;"> 6</span> MB-0010    DECEASED        Died of Disease      TRUE    </span>
<span class="co">## <span style="color: #BCBCBC;"> 7</span> MB-0014    LIVING          Living               FALSE   </span>
<span class="co">## <span style="color: #BCBCBC;"> 8</span> MB-0022    DECEASED        Died of Other Causes TRUE    </span>
<span class="co">## <span style="color: #BCBCBC;"> 9</span> MB-0028    DECEASED        Died of Other Causes TRUE    </span>
<span class="co">## <span style="color: #BCBCBC;">10</span> MB-0035    DECEASED        Died of Disease      TRUE    </span>
<span class="co">## <span style="color: #949494;"># … with 1,894 more rows</span></span></code></pre>
<p>Notice the similarities with the <code><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter()</a></code> function. The
first argument is the data frame we are operating on and the arguments
that follow on are specific to the operation in question, in this case,
the variables (columns) to select. Note that the variables do not need
to be put in quotes, and the returned value is another data frame, even
if only one column was selected.</p>
<p>We can alter the order of the variables (columns).</p>
<div class="sourceCode" id="cb30"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html" class="external-link">select</a></span><span class="op">(</span><span class="va">metabric</span>, <span class="va">Patient_ID</span>, <span class="va">Vital_status</span>, <span class="va">Survival_status</span>, <span class="va">Deceased</span><span class="op">)</span></code></pre></div>
<pre><code><span class="co">## <span style="color: #949494;"># A tibble: 1,904 × 4</span></span>
<span class="co">##    Patient_ID Vital_status         Survival_status Deceased</span>
<span class="co">##    <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>      <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>                <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>           <span style="color: #949494; font-style: italic;">&lt;lgl&gt;</span>   </span>
<span class="co">## <span style="color: #BCBCBC;"> 1</span> MB-0000    Living               LIVING          FALSE   </span>
<span class="co">## <span style="color: #BCBCBC;"> 2</span> MB-0002    Living               LIVING          FALSE   </span>
<span class="co">## <span style="color: #BCBCBC;"> 3</span> MB-0005    Died of Disease      DECEASED        TRUE    </span>
<span class="co">## <span style="color: #BCBCBC;"> 4</span> MB-0006    Living               LIVING          FALSE   </span>
<span class="co">## <span style="color: #BCBCBC;"> 5</span> MB-0008    Died of Disease      DECEASED        TRUE    </span>
<span class="co">## <span style="color: #BCBCBC;"> 6</span> MB-0010    Died of Disease      DECEASED        TRUE    </span>
<span class="co">## <span style="color: #BCBCBC;"> 7</span> MB-0014    Living               LIVING          FALSE   </span>
<span class="co">## <span style="color: #BCBCBC;"> 8</span> MB-0022    Died of Other Causes DECEASED        TRUE    </span>
<span class="co">## <span style="color: #BCBCBC;"> 9</span> MB-0028    Died of Other Causes DECEASED        TRUE    </span>
<span class="co">## <span style="color: #BCBCBC;">10</span> MB-0035    Died of Disease      DECEASED        TRUE    </span>
<span class="co">## <span style="color: #949494;"># … with 1,894 more rows</span></span></code></pre>
<p>We can also select a range of columns using
<strong><code>:</code></strong>, e.g. to select the patient identifier
and all the columns between <code>Tumour_size</code> and
<code>Cancer_type</code> we could run the following
<code><a href="https://dplyr.tidyverse.org/reference/select.html" class="external-link">select()</a></code> command.</p>
<div class="sourceCode" id="cb32"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html" class="external-link">select</a></span><span class="op">(</span><span class="va">metabric</span>, <span class="va">Patient_ID</span>, <span class="va">Chemotherapy</span><span class="op">:</span><span class="va">Tumour_stage</span><span class="op">)</span></code></pre></div>
<pre><code><span class="co">## <span style="color: #949494;"># A tibble: 1,904 × 5</span></span>
<span class="co">##    Patient_ID Chemotherapy Radiotherapy Tumour_size Tumour_stage</span>
<span class="co">##    <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>      <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>        <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>              <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>        <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span></span>
<span class="co">## <span style="color: #BCBCBC;"> 1</span> MB-0000    NO           YES                   22            2</span>
<span class="co">## <span style="color: #BCBCBC;"> 2</span> MB-0002    NO           YES                   10            1</span>
<span class="co">## <span style="color: #BCBCBC;"> 3</span> MB-0005    YES          NO                    15            2</span>
<span class="co">## <span style="color: #BCBCBC;"> 4</span> MB-0006    YES          YES                   25            2</span>
<span class="co">## <span style="color: #BCBCBC;"> 5</span> MB-0008    YES          YES                   40            2</span>
<span class="co">## <span style="color: #BCBCBC;"> 6</span> MB-0010    NO           YES                   31            4</span>
<span class="co">## <span style="color: #BCBCBC;"> 7</span> MB-0014    YES          YES                   10            2</span>
<span class="co">## <span style="color: #BCBCBC;"> 8</span> MB-0022    NO           YES                   29            2</span>
<span class="co">## <span style="color: #BCBCBC;"> 9</span> MB-0028    NO           YES                   16            2</span>
<span class="co">## <span style="color: #BCBCBC;">10</span> MB-0035    NO           NO                    28            2</span>
<span class="co">## <span style="color: #949494;"># … with 1,894 more rows</span></span></code></pre>
<p>The help page for <code>select</code> points to some special
functions that can be used within <code><a href="https://dplyr.tidyverse.org/reference/select.html" class="external-link">select()</a></code>. We can find all
the columns, for example, that contain the term “status” using
<code><a href="https://tidyselect.r-lib.org/reference/starts_with.html" class="external-link">contains()</a></code>.</p>
<div class="sourceCode" id="cb34"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html" class="external-link">select</a></span><span class="op">(</span><span class="va">metabric</span>, <span class="fu"><a href="https://tidyselect.r-lib.org/reference/starts_with.html" class="external-link">contains</a></span><span class="op">(</span><span class="st">"status"</span><span class="op">)</span><span class="op">)</span></code></pre></div>
<pre><code><span class="co">## <span style="color: #949494;"># A tibble: 1,904 × 7</span></span>
<span class="co">##    Survival_status Vital_status Lymph_node_stat… ER_status PR_status HER2_status</span>
<span class="co">##    <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>           <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>                   <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>     <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>     <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>      </span>
<span class="co">## <span style="color: #BCBCBC;"> 1</span> LIVING          Living                      3 Positive  Negative  Negative   </span>
<span class="co">## <span style="color: #BCBCBC;"> 2</span> LIVING          Living                      1 Positive  Positive  Negative   </span>
<span class="co">## <span style="color: #BCBCBC;"> 3</span> DECEASED        Died of Dis…                2 Positive  Positive  Negative   </span>
<span class="co">## <span style="color: #BCBCBC;"> 4</span> LIVING          Living                      2 Positive  Positive  Negative   </span>
<span class="co">## <span style="color: #BCBCBC;"> 5</span> DECEASED        Died of Dis…                3 Positive  Positive  Negative   </span>
<span class="co">## <span style="color: #BCBCBC;"> 6</span> DECEASED        Died of Dis…                1 Positive  Positive  Negative   </span>
<span class="co">## <span style="color: #BCBCBC;"> 7</span> LIVING          Living                      2 Positive  Positive  Negative   </span>
<span class="co">## <span style="color: #BCBCBC;"> 8</span> DECEASED        Died of Oth…                2 Positive  Negative  Negative   </span>
<span class="co">## <span style="color: #BCBCBC;"> 9</span> DECEASED        Died of Oth…                2 Positive  Negative  Negative   </span>
<span class="co">## <span style="color: #BCBCBC;">10</span> DECEASED        Died of Dis…                1 Positive  Negative  Negative   </span>
<span class="co">## <span style="color: #949494;"># … with 1,894 more rows, and 1 more variable:</span></span>
<span class="co">## <span style="color: #949494;">#   HER2_status_measured_by_SNP6 &lt;chr&gt;</span></span></code></pre>
<p>If we only wanted those ending with “status” we could use
<code><a href="https://tidyselect.r-lib.org/reference/starts_with.html" class="external-link">ends_with()</a></code> instead.</p>
<div class="sourceCode" id="cb36"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html" class="external-link">select</a></span><span class="op">(</span><span class="va">metabric</span>, <span class="fu"><a href="https://tidyselect.r-lib.org/reference/starts_with.html" class="external-link">ends_with</a></span><span class="op">(</span><span class="st">"status"</span><span class="op">)</span><span class="op">)</span></code></pre></div>
<pre><code><span class="co">## <span style="color: #949494;"># A tibble: 1,904 × 6</span></span>
<span class="co">##    Survival_status Vital_status Lymph_node_stat… ER_status PR_status HER2_status</span>
<span class="co">##    <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>           <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>                   <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>     <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>     <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>      </span>
<span class="co">## <span style="color: #BCBCBC;"> 1</span> LIVING          Living                      3 Positive  Negative  Negative   </span>
<span class="co">## <span style="color: #BCBCBC;"> 2</span> LIVING          Living                      1 Positive  Positive  Negative   </span>
<span class="co">## <span style="color: #BCBCBC;"> 3</span> DECEASED        Died of Dis…                2 Positive  Positive  Negative   </span>
<span class="co">## <span style="color: #BCBCBC;"> 4</span> LIVING          Living                      2 Positive  Positive  Negative   </span>
<span class="co">## <span style="color: #BCBCBC;"> 5</span> DECEASED        Died of Dis…                3 Positive  Positive  Negative   </span>
<span class="co">## <span style="color: #BCBCBC;"> 6</span> DECEASED        Died of Dis…                1 Positive  Positive  Negative   </span>
<span class="co">## <span style="color: #BCBCBC;"> 7</span> LIVING          Living                      2 Positive  Positive  Negative   </span>
<span class="co">## <span style="color: #BCBCBC;"> 8</span> DECEASED        Died of Oth…                2 Positive  Negative  Negative   </span>
<span class="co">## <span style="color: #BCBCBC;"> 9</span> DECEASED        Died of Oth…                2 Positive  Negative  Negative   </span>
<span class="co">## <span style="color: #BCBCBC;">10</span> DECEASED        Died of Dis…                1 Positive  Negative  Negative   </span>
<span class="co">## <span style="color: #949494;"># … with 1,894 more rows</span></span></code></pre>
<p>We can also select those columns we’re not interested in and that
shouldn’t be included by prefixing the columns with
<strong><code>-</code></strong>.</p>
<div class="sourceCode" id="cb38"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html" class="external-link">select</a></span><span class="op">(</span><span class="va">metabric</span>, <span class="op">-</span><span class="va">Cohort</span><span class="op">)</span></code></pre></div>
<pre><code><span class="co">## <span style="color: #949494;"># A tibble: 1,904 × 32</span></span>
<span class="co">##    Patient_ID Age_at_diagnosis Survival_time Survival_status Vital_status       </span>
<span class="co">##    <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>                 <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>         <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>           <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>              </span>
<span class="co">## <span style="color: #BCBCBC;"> 1</span> MB-0000                75.6         140.  LIVING          Living             </span>
<span class="co">## <span style="color: #BCBCBC;"> 2</span> MB-0002                43.2          84.6 LIVING          Living             </span>
<span class="co">## <span style="color: #BCBCBC;"> 3</span> MB-0005                48.9         164.  DECEASED        Died of Disease    </span>
<span class="co">## <span style="color: #BCBCBC;"> 4</span> MB-0006                47.7         165.  LIVING          Living             </span>
<span class="co">## <span style="color: #BCBCBC;"> 5</span> MB-0008                77.0          41.4 DECEASED        Died of Disease    </span>
<span class="co">## <span style="color: #BCBCBC;"> 6</span> MB-0010                78.8           7.8 DECEASED        Died of Disease    </span>
<span class="co">## <span style="color: #BCBCBC;"> 7</span> MB-0014                56.4         164.  LIVING          Living             </span>
<span class="co">## <span style="color: #BCBCBC;"> 8</span> MB-0022                89.1          99.5 DECEASED        Died of Other Caus…</span>
<span class="co">## <span style="color: #BCBCBC;"> 9</span> MB-0028                86.4          36.6 DECEASED        Died of Other Caus…</span>
<span class="co">## <span style="color: #BCBCBC;">10</span> MB-0035                84.2          36.3 DECEASED        Died of Disease    </span>
<span class="co">## <span style="color: #949494;"># … with 1,894 more rows, and 27 more variables: Chemotherapy &lt;chr&gt;,</span></span>
<span class="co">## <span style="color: #949494;">#   Radiotherapy &lt;chr&gt;, Tumour_size &lt;dbl&gt;, Tumour_stage &lt;dbl&gt;,</span></span>
<span class="co">## <span style="color: #949494;">#   Neoplasm_histologic_grade &lt;dbl&gt;, Lymph_nodes_examined_positive &lt;dbl&gt;,</span></span>
<span class="co">## <span style="color: #949494;">#   Lymph_node_status &lt;dbl&gt;, Cancer_type &lt;chr&gt;, ER_status &lt;chr&gt;,</span></span>
<span class="co">## <span style="color: #949494;">#   PR_status &lt;chr&gt;, HER2_status &lt;chr&gt;, HER2_status_measured_by_SNP6 &lt;chr&gt;,</span></span>
<span class="co">## <span style="color: #949494;">#   PAM50 &lt;chr&gt;, `3-gene_classifier` &lt;chr&gt;, Nottingham_prognostic_index &lt;dbl&gt;,</span></span>
<span class="co">## <span style="color: #949494;">#   Cellularity &lt;chr&gt;, Integrative_cluster &lt;chr&gt;, Mutation_count &lt;dbl&gt;, …</span></span></code></pre>
<p>You can use a combination of explicit naming, ranges, helper
functions and negation to select the columns of interest.</p>
<div class="sourceCode" id="cb40"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">selected_columns</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html" class="external-link">select</a></span><span class="op">(</span><span class="va">metabric</span>, <span class="va">Patient_ID</span>, <span class="fu"><a href="https://tidyselect.r-lib.org/reference/starts_with.html" class="external-link">starts_with</a></span><span class="op">(</span><span class="st">"Tumour_"</span><span class="op">)</span>, <span class="va">`3-gene_classifier`</span><span class="op">:</span><span class="va">Integrative_cluster</span>, <span class="op">-</span><span class="va">Cellularity</span><span class="op">)</span>
<span class="va">selected_columns</span></code></pre></div>
<pre><code><span class="co">## <span style="color: #949494;"># A tibble: 1,904 × 6</span></span>
<span class="co">##    Patient_ID Tumour_size Tumour_stage `3-gene_classifier`   Nottingham_prognos…</span>
<span class="co">##    <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>            <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>        <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>                               <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span></span>
<span class="co">## <span style="color: #BCBCBC;"> 1</span> MB-0000             22            2 ER-/HER2-                            6.04</span>
<span class="co">## <span style="color: #BCBCBC;"> 2</span> MB-0002             10            1 ER+/HER2- High Prolif                4.02</span>
<span class="co">## <span style="color: #BCBCBC;"> 3</span> MB-0005             15            2 <span style="color: #BB0000;">NA</span>                                   4.03</span>
<span class="co">## <span style="color: #BCBCBC;"> 4</span> MB-0006             25            2 <span style="color: #BB0000;">NA</span>                                   4.05</span>
<span class="co">## <span style="color: #BCBCBC;"> 5</span> MB-0008             40            2 ER+/HER2- High Prolif                6.08</span>
<span class="co">## <span style="color: #BCBCBC;"> 6</span> MB-0010             31            4 ER+/HER2- High Prolif                4.06</span>
<span class="co">## <span style="color: #BCBCBC;"> 7</span> MB-0014             10            2 <span style="color: #BB0000;">NA</span>                                   4.02</span>
<span class="co">## <span style="color: #BCBCBC;"> 8</span> MB-0022             29            2 <span style="color: #BB0000;">NA</span>                                   4.06</span>
<span class="co">## <span style="color: #BCBCBC;"> 9</span> MB-0028             16            2 ER+/HER2- High Prolif                5.03</span>
<span class="co">## <span style="color: #BCBCBC;">10</span> MB-0035             28            2 ER+/HER2- High Prolif                3.06</span>
<span class="co">## <span style="color: #949494;"># … with 1,894 more rows, and 1 more variable: Integrative_cluster &lt;chr&gt;</span></span></code></pre>
<p>You can also use <code><a href="https://dplyr.tidyverse.org/reference/select.html" class="external-link">select()</a></code> to completely reorder the
columns so they’re in the order of your choosing. The
<code><a href="https://tidyselect.r-lib.org/reference/everything.html" class="external-link">everything()</a></code> helper function is useful in this context,
particularly if what you’re really interested in is bringing one or more
columns to the left hand side and then including everything else
afterwards in whatever order they were already in.</p>
<div class="sourceCode" id="cb42"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html" class="external-link">select</a></span><span class="op">(</span><span class="va">metabric</span>, <span class="va">Patient_ID</span>, <span class="va">Survival_status</span>, <span class="va">Tumour_stage</span>, <span class="fu"><a href="https://tidyselect.r-lib.org/reference/everything.html" class="external-link">everything</a></span><span class="op">(</span><span class="op">)</span><span class="op">)</span></code></pre></div>
<pre><code><span class="co">## <span style="color: #949494;"># A tibble: 1,904 × 33</span></span>
<span class="co">##    Patient_ID Survival_status Tumour_stage Cohort Age_at_diagnosis Survival_time</span>
<span class="co">##    <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>      <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>                  <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>  <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>            <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>         <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span></span>
<span class="co">## <span style="color: #BCBCBC;"> 1</span> MB-0000    LIVING                     2      1             75.6         140. </span>
<span class="co">## <span style="color: #BCBCBC;"> 2</span> MB-0002    LIVING                     1      1             43.2          84.6</span>
<span class="co">## <span style="color: #BCBCBC;"> 3</span> MB-0005    DECEASED                   2      1             48.9         164. </span>
<span class="co">## <span style="color: #BCBCBC;"> 4</span> MB-0006    LIVING                     2      1             47.7         165. </span>
<span class="co">## <span style="color: #BCBCBC;"> 5</span> MB-0008    DECEASED                   2      1             77.0          41.4</span>
<span class="co">## <span style="color: #BCBCBC;"> 6</span> MB-0010    DECEASED                   4      1             78.8           7.8</span>
<span class="co">## <span style="color: #BCBCBC;"> 7</span> MB-0014    LIVING                     2      1             56.4         164. </span>
<span class="co">## <span style="color: #BCBCBC;"> 8</span> MB-0022    DECEASED                   2      1             89.1          99.5</span>
<span class="co">## <span style="color: #BCBCBC;"> 9</span> MB-0028    DECEASED                   2      1             86.4          36.6</span>
<span class="co">## <span style="color: #BCBCBC;">10</span> MB-0035    DECEASED                   2      1             84.2          36.3</span>
<span class="co">## <span style="color: #949494;"># … with 1,894 more rows, and 27 more variables: Vital_status &lt;chr&gt;,</span></span>
<span class="co">## <span style="color: #949494;">#   Chemotherapy &lt;chr&gt;, Radiotherapy &lt;chr&gt;, Tumour_size &lt;dbl&gt;,</span></span>
<span class="co">## <span style="color: #949494;">#   Neoplasm_histologic_grade &lt;dbl&gt;, Lymph_nodes_examined_positive &lt;dbl&gt;,</span></span>
<span class="co">## <span style="color: #949494;">#   Lymph_node_status &lt;dbl&gt;, Cancer_type &lt;chr&gt;, ER_status &lt;chr&gt;,</span></span>
<span class="co">## <span style="color: #949494;">#   PR_status &lt;chr&gt;, HER2_status &lt;chr&gt;, HER2_status_measured_by_SNP6 &lt;chr&gt;,</span></span>
<span class="co">## <span style="color: #949494;">#   PAM50 &lt;chr&gt;, `3-gene_classifier` &lt;chr&gt;, Nottingham_prognostic_index &lt;dbl&gt;,</span></span>
<span class="co">## <span style="color: #949494;">#   Cellularity &lt;chr&gt;, Integrative_cluster &lt;chr&gt;, Mutation_count &lt;dbl&gt;, …</span></span></code></pre>
<p>Finally, columns can be renamed as part of the selection process.</p>
<div class="sourceCode" id="cb44"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html" class="external-link">select</a></span><span class="op">(</span><span class="va">metabric</span>, <span class="va">Patient_ID</span>, Classification <span class="op">=</span> <span class="va">`3-gene_classifier`</span>, NPI <span class="op">=</span> <span class="va">Nottingham_prognostic_index</span><span class="op">)</span></code></pre></div>
<pre><code><span class="co">## <span style="color: #949494;"># A tibble: 1,904 × 3</span></span>
<span class="co">##    Patient_ID Classification          NPI</span>
<span class="co">##    <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>      <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>                 <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span></span>
<span class="co">## <span style="color: #BCBCBC;"> 1</span> MB-0000    ER-/HER2-              6.04</span>
<span class="co">## <span style="color: #BCBCBC;"> 2</span> MB-0002    ER+/HER2- High Prolif  4.02</span>
<span class="co">## <span style="color: #BCBCBC;"> 3</span> MB-0005    <span style="color: #BB0000;">NA</span>                     4.03</span>
<span class="co">## <span style="color: #BCBCBC;"> 4</span> MB-0006    <span style="color: #BB0000;">NA</span>                     4.05</span>
<span class="co">## <span style="color: #BCBCBC;"> 5</span> MB-0008    ER+/HER2- High Prolif  6.08</span>
<span class="co">## <span style="color: #BCBCBC;"> 6</span> MB-0010    ER+/HER2- High Prolif  4.06</span>
<span class="co">## <span style="color: #BCBCBC;"> 7</span> MB-0014    <span style="color: #BB0000;">NA</span>                     4.02</span>
<span class="co">## <span style="color: #BCBCBC;"> 8</span> MB-0022    <span style="color: #BB0000;">NA</span>                     4.06</span>
<span class="co">## <span style="color: #BCBCBC;"> 9</span> MB-0028    ER+/HER2- High Prolif  5.03</span>
<span class="co">## <span style="color: #BCBCBC;">10</span> MB-0035    ER+/HER2- High Prolif  3.06</span>
<span class="co">## <span style="color: #949494;"># … with 1,894 more rows</span></span></code></pre>
<p>Note that dplyr provides the <code><a href="https://dplyr.tidyverse.org/reference/rename.html" class="external-link">rename()</a></code> function for when
we only want to rename a column and not select a subset of columns.</p>
<hr>
</div>
<div class="section level2">
<h2 id="chaining-operations-using">Chaining operations using <code>%&gt;%</code><a class="anchor" aria-label="anchor" href="#chaining-operations-using"></a>
</h2>
<p>Let’s consider again an earlier example in which we filtered the
METABRIC data set to retain just the patients who were still alive at
the time of the study and had survived for more than 10 years (120
months). We use <code><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter()</a></code> to select the rows corresponding
to the patients meeting these criteria and can then use
<code><a href="https://dplyr.tidyverse.org/reference/select.html" class="external-link">select()</a></code> to only display the variables (columns) we’re most
interested in.</p>
<div class="sourceCode" id="cb46"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">patients_of_interest</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="va">metabric</span>, <span class="va">Survival_status</span> <span class="op">==</span> <span class="st">"LIVING"</span>, <span class="va">Survival_time</span> <span class="op">&gt;</span> <span class="fl">120</span><span class="op">)</span>
<span class="va">patient_details_of_interest</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html" class="external-link">select</a></span><span class="op">(</span><span class="va">patients_of_interest</span>, <span class="va">Patient_ID</span>, <span class="va">Survival_time</span>, <span class="va">Tumour_stage</span>, <span class="va">Nottingham_prognostic_index</span><span class="op">)</span>
<span class="va">patient_details_of_interest</span></code></pre></div>
<pre><code><span class="co">## <span style="color: #949494;"># A tibble: 545 × 4</span></span>
<span class="co">##    Patient_ID Survival_time Tumour_stage Nottingham_prognostic_index</span>
<span class="co">##    <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>              <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>        <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>                       <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span></span>
<span class="co">## <span style="color: #BCBCBC;"> 1</span> MB-0000             140.            2                        6.04</span>
<span class="co">## <span style="color: #BCBCBC;"> 2</span> MB-0006             165.            2                        4.05</span>
<span class="co">## <span style="color: #BCBCBC;"> 3</span> MB-0014             164.            2                        4.02</span>
<span class="co">## <span style="color: #BCBCBC;"> 4</span> MB-0039             164.            1                        2.04</span>
<span class="co">## <span style="color: #BCBCBC;"> 5</span> MB-0045             165.            2                        5.04</span>
<span class="co">## <span style="color: #BCBCBC;"> 6</span> MB-0053             161.            2                        3.05</span>
<span class="co">## <span style="color: #BCBCBC;"> 7</span> MB-0054             160.            2                        4.07</span>
<span class="co">## <span style="color: #BCBCBC;"> 8</span> MB-0060             141.            2                        4.05</span>
<span class="co">## <span style="color: #BCBCBC;"> 9</span> MB-0062             154.            1                        4.03</span>
<span class="co">## <span style="color: #BCBCBC;">10</span> MB-0066             157.            2                        4.03</span>
<span class="co">## <span style="color: #949494;"># … with 535 more rows</span></span></code></pre>
<p>Here we’ve used an intermediate variable,
<code>patients_of_interest</code>, which we only needed in order to get
to the final result. We could just have used the same name to avoid
cluttering our environment and overwritten the results from the
<code><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter()</a></code> operation with those of the <code><a href="https://dplyr.tidyverse.org/reference/select.html" class="external-link">select()</a></code>
operation.</p>
<div class="sourceCode" id="cb48"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">patients_of_interest</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html" class="external-link">select</a></span><span class="op">(</span><span class="va">patients_of_interest</span>, <span class="va">Patient_ID</span>, <span class="va">Survival_time</span>, <span class="va">Tumour_stage</span>, <span class="va">Nottingham_prognostic_index</span><span class="op">)</span></code></pre></div>
<p>Another less readable way of writing this code is to nest the
<code><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter()</a></code> function call inside the <code><a href="https://dplyr.tidyverse.org/reference/select.html" class="external-link">select()</a></code>.
Although this looks very unwieldy and is not easy to follow, nested
function calls are very common in a lot of R code you may come
across.</p>
<div class="sourceCode" id="cb49"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">patients_of_interest</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html" class="external-link">select</a></span><span class="op">(</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="va">metabric</span>, <span class="va">Survival_status</span> <span class="op">==</span> <span class="st">"LIVING"</span>, <span class="va">Survival_time</span> <span class="op">&gt;</span> <span class="fl">120</span><span class="op">)</span>, <span class="va">Patient_ID</span>, <span class="va">Survival_time</span>, <span class="va">Tumour_stage</span>, <span class="va">Nottingham_prognostic_index</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">nrow</a></span><span class="op">(</span><span class="va">patients_of_interest</span><span class="op">)</span></code></pre></div>
<pre><code><span class="co">## [1] 545</span></code></pre>
<p>However, there is another way chaining together a series of
operations into a mini workflow that is elegant, intuitive and makes for
very readable R code. We can use the <strong>pipe</strong> operator,
<strong><code>%&gt;%</code></strong>.</p>
<div class="rmdblock">
<p>
<strong>The pipe operator <code>%&gt;%</code></strong>
</p>
<p>
The pipe operator takes the output from one operation, i.e. whatever is
on the left-hand side of <code>%&gt;%</code> and passes it in as the
first argument to the second operation, or function, on the right-hand
side.
</p>
<p>
<strong><code>x %&gt;% f(y)</code></strong> is equivalent to
<strong><code>f(x, y)</code></strong>
</p>
<p>
For example:
</p>
<p>
<code>select(starwars, name, height, mass)</code>
</p>
<p>
can be rewritten as
</p>
<p>
<code>starwars %&gt;% select(name, height, mass)</code>
</p>
<p>
This allows for chaining of operations into workflows, e.g.
</p>
<p>
<code>starwars %&gt;%</code><br>     <code>filter(species == “Droid”)
%&gt;%</code><br>     <code>select(name, height, mass)</code>
</p>
<p>
The <code>%&gt;%</code> operator comes from the <code>magrittr</code>
package (do you get the reference?) and is available when we load the
tidyverse using <code><a href="https://tidyverse.tidyverse.org" class="external-link">library(tidyverse)</a></code>.
</p>
<p>
Piping in R was motivated by the Unix pipe, <code>|</code>, in which the
output from one process is redirected to be the input for the next. This
is so named because the flow from one process or operation to the next
resembles a pipeline.
</p>
<p>
Note that since R v4.1 (released May 2021) R now has it’s own native
pipe <code>|&gt;</code>.
</p>
</div>
<p>We can rewrite the code for our filtering and column selection
operations as follows.</p>
<div class="sourceCode" id="cb51"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">patients_of_interest</span> <span class="op">&lt;-</span> <span class="va">metabric</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span>
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="va">Survival_status</span> <span class="op">==</span> <span class="st">"LIVING"</span>, <span class="va">Survival_time</span> <span class="op">&gt;</span> <span class="fl">120</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span>
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html" class="external-link">select</a></span><span class="op">(</span><span class="va">Patient_ID</span>, <span class="va">Survival_time</span>, <span class="va">Tumour_stage</span>, <span class="va">Nottingham_prognostic_index</span><span class="op">)</span></code></pre></div>
<p>Note how each operation takes the output from the previous operation
as its first argument. This way of coding is embraced wholeheartedly in
the tidyverse hence almost every tidyverse function that works on data
frames has the data frame as its first argument. It is also the reason
why tidyverse functions return a data frame regardless of whether the
output could be recast as a vector or a single value.</p>
<p>“Piping”, the act of chaining operations together, becomes really
useful when there are several steps involved in filtering and
transforming a data set.</p>
<p>The usual way of developing a workflow is to build it up one step at
a time, testing the output produced at each stage. Let’s do that for
this case.</p>
<p>We start by considering just the patients who are living.</p>
<div class="sourceCode" id="cb52"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">patients_of_interest</span> <span class="op">&lt;-</span> <span class="va">metabric</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span>
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="va">Survival_status</span> <span class="op">==</span> <span class="st">"LIVING"</span><span class="op">)</span></code></pre></div>
<p>We then add another filter for the survival time.</p>
<div class="sourceCode" id="cb53"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">patients_of_interest</span> <span class="op">&lt;-</span> <span class="va">metabric</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span>
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="va">Survival_status</span> <span class="op">==</span> <span class="st">"LIVING"</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span>
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="va">Survival_time</span> <span class="op">&gt;</span> <span class="fl">120</span><span class="op">)</span></code></pre></div>
<p>At each stage we look at the resulting
<code>patients_of_interest</code> data frame to check we’re happy with
the result.</p>
<p>Finally we only want certain columns, so we add a
<code><a href="https://dplyr.tidyverse.org/reference/select.html" class="external-link">select()</a></code> operation.</p>
<div class="sourceCode" id="cb54"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">patients_of_interest</span> <span class="op">&lt;-</span> <span class="va">metabric</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span>
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="va">Survival_status</span> <span class="op">==</span> <span class="st">"LIVING"</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span>
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="va">Survival_time</span> <span class="op">&gt;</span> <span class="fl">120</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span>
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html" class="external-link">select</a></span><span class="op">(</span><span class="va">Patient_ID</span>, <span class="va">Survival_time</span>, <span class="va">Tumour_stage</span>, <span class="va">Nottingham_prognostic_index</span><span class="op">)</span>
<span class="co"># print out the result</span>
<span class="va">patients_of_interest</span></code></pre></div>
<pre><code><span class="co">## <span style="color: #949494;"># A tibble: 545 × 4</span></span>
<span class="co">##    Patient_ID Survival_time Tumour_stage Nottingham_prognostic_index</span>
<span class="co">##    <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>              <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>        <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>                       <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span></span>
<span class="co">## <span style="color: #BCBCBC;"> 1</span> MB-0000             140.            2                        6.04</span>
<span class="co">## <span style="color: #BCBCBC;"> 2</span> MB-0006             165.            2                        4.05</span>
<span class="co">## <span style="color: #BCBCBC;"> 3</span> MB-0014             164.            2                        4.02</span>
<span class="co">## <span style="color: #BCBCBC;"> 4</span> MB-0039             164.            1                        2.04</span>
<span class="co">## <span style="color: #BCBCBC;"> 5</span> MB-0045             165.            2                        5.04</span>
<span class="co">## <span style="color: #BCBCBC;"> 6</span> MB-0053             161.            2                        3.05</span>
<span class="co">## <span style="color: #BCBCBC;"> 7</span> MB-0054             160.            2                        4.07</span>
<span class="co">## <span style="color: #BCBCBC;"> 8</span> MB-0060             141.            2                        4.05</span>
<span class="co">## <span style="color: #BCBCBC;"> 9</span> MB-0062             154.            1                        4.03</span>
<span class="co">## <span style="color: #BCBCBC;">10</span> MB-0066             157.            2                        4.03</span>
<span class="co">## <span style="color: #949494;"># … with 535 more rows</span></span></code></pre>
<p>When continuing our workflow across multiple lines, we need to be
careful to ensure the <code>%&gt;%</code> is at the end of the line. If
we try to place this at the start of the next line, R will think we’ve
finished the workflow prematurely and will report an error at what it
considers the next statement, i.e. the line that begins with
<code>%&gt;%</code>.</p>
<div class="sourceCode" id="cb56"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb56-1"><a href="#cb56-1" aria-hidden="true" tabindex="-1"></a><span class="co"># R considers the following to be 2 separate commands, the first of which ends</span></span>
<span id="cb56-2"><a href="#cb56-2" aria-hidden="true" tabindex="-1"></a><span class="co"># with the first filter operation and runs successfully.</span></span>
<span id="cb56-3"><a href="#cb56-3" aria-hidden="true" tabindex="-1"></a><span class="co"># The second statement is the third and last line, is not a valid commmand and</span></span>
<span id="cb56-4"><a href="#cb56-4" aria-hidden="true" tabindex="-1"></a><span class="co"># so you'll get an error message</span></span>
<span id="cb56-5"><a href="#cb56-5" aria-hidden="true" tabindex="-1"></a>patients_of_interest <span class="ot">&lt;-</span> metabric <span class="sc">%&gt;%</span></span>
<span id="cb56-6"><a href="#cb56-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(Survival_status <span class="sc">==</span> <span class="st">"LIVING"</span>)</span>
<span id="cb56-7"><a href="#cb56-7" aria-hidden="true" tabindex="-1"></a>  <span class="sc">%&gt;%</span> <span class="fu">filter</span>(Survival_time <span class="sc">&gt;</span> <span class="dv">120</span>)</span></code></pre></div>
<p>This is very similar to what we saw with adding layers and other
components to a ggplot using the <code>+</code> operator, where we
needed the <code>+</code> to be at the end of a line.</p>
<p>We’ll be using the pipe <code>%&gt;%</code> operator throughout the
rest of the course so you’d better get used to it. But actually we think
you’ll come to love it as much as we do.</p>
<hr>
</div>
<div class="section level2">
<h2 id="sorting-using-arrange">Sorting using <code>arrange()</code><a class="anchor" aria-label="anchor" href="#sorting-using-arrange"></a>
</h2>
<p>It is sometimes quite useful to sort our data frame based on the
values in one or more of the columns, particularly when displaying the
contents or saving them to a file. The <code><a href="https://dplyr.tidyverse.org/reference/arrange.html" class="external-link">arrange()</a></code> function
in dplyr provides this sorting capability.</p>
<p>For example, we can sort the METABRIC patients into order of
increasing survival time.</p>
<div class="sourceCode" id="cb57"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://dplyr.tidyverse.org/reference/arrange.html" class="external-link">arrange</a></span><span class="op">(</span><span class="va">metabric</span>, <span class="va">Survival_time</span><span class="op">)</span></code></pre></div>
<pre><code><span class="co">## <span style="color: #949494;"># A tibble: 1,904 × 33</span></span>
<span class="co">##    Patient_ID Cohort Age_at_diagnosis Survival_time Survival_status Vital_status</span>
<span class="co">##    <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>       <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>            <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>         <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>           <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>       </span>
<span class="co">## <span style="color: #BCBCBC;"> 1</span> MB-0284         1             51.4         0     LIVING          Living      </span>
<span class="co">## <span style="color: #BCBCBC;"> 2</span> MB-6229         5             75.3         0.1   DECEASED        Died of Dis…</span>
<span class="co">## <span style="color: #BCBCBC;"> 3</span> MB-0627         1             54.1         0.767 LIVING          Living      </span>
<span class="co">## <span style="color: #BCBCBC;"> 4</span> MB-0880         1             73.6         1.23  LIVING          Living      </span>
<span class="co">## <span style="color: #BCBCBC;"> 5</span> MB-0125         1             74.0         1.27  LIVING          Living      </span>
<span class="co">## <span style="color: #BCBCBC;"> 6</span> MB-0374         1             34.7         1.43  LIVING          Living      </span>
<span class="co">## <span style="color: #BCBCBC;"> 7</span> MB-0148         1             53.2         1.77  LIVING          Living      </span>
<span class="co">## <span style="color: #BCBCBC;"> 8</span> MB-5525         3             63.2         2     LIVING          Living      </span>
<span class="co">## <span style="color: #BCBCBC;"> 9</span> MB-6092         5             80.6         2.3   DECEASED        Died of Oth…</span>
<span class="co">## <span style="color: #BCBCBC;">10</span> MB-0117         1             60.1         2.4   LIVING          Living      </span>
<span class="co">## <span style="color: #949494;"># … with 1,894 more rows, and 27 more variables: Chemotherapy &lt;chr&gt;,</span></span>
<span class="co">## <span style="color: #949494;">#   Radiotherapy &lt;chr&gt;, Tumour_size &lt;dbl&gt;, Tumour_stage &lt;dbl&gt;,</span></span>
<span class="co">## <span style="color: #949494;">#   Neoplasm_histologic_grade &lt;dbl&gt;, Lymph_nodes_examined_positive &lt;dbl&gt;,</span></span>
<span class="co">## <span style="color: #949494;">#   Lymph_node_status &lt;dbl&gt;, Cancer_type &lt;chr&gt;, ER_status &lt;chr&gt;,</span></span>
<span class="co">## <span style="color: #949494;">#   PR_status &lt;chr&gt;, HER2_status &lt;chr&gt;, HER2_status_measured_by_SNP6 &lt;chr&gt;,</span></span>
<span class="co">## <span style="color: #949494;">#   PAM50 &lt;chr&gt;, `3-gene_classifier` &lt;chr&gt;, Nottingham_prognostic_index &lt;dbl&gt;,</span></span>
<span class="co">## <span style="color: #949494;">#   Cellularity &lt;chr&gt;, Integrative_cluster &lt;chr&gt;, Mutation_count &lt;dbl&gt;, …</span></span></code></pre>
<p>Or we might be more interested in the patients that survived the
longest so would need the order to be of decreasing survival time. For
that we can use the helper function <code><a href="https://dplyr.tidyverse.org/reference/desc.html" class="external-link">desc()</a></code> that works
specifically with <code><a href="https://dplyr.tidyverse.org/reference/arrange.html" class="external-link">arrange()</a></code>.</p>
<div class="sourceCode" id="cb59"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://dplyr.tidyverse.org/reference/arrange.html" class="external-link">arrange</a></span><span class="op">(</span><span class="va">metabric</span>, <span class="fu"><a href="https://dplyr.tidyverse.org/reference/desc.html" class="external-link">desc</a></span><span class="op">(</span><span class="va">Survival_time</span><span class="op">)</span><span class="op">)</span></code></pre></div>
<pre><code><span class="co">## <span style="color: #949494;"># A tibble: 1,904 × 33</span></span>
<span class="co">##    Patient_ID Cohort Age_at_diagnosis Survival_time Survival_status Vital_status</span>
<span class="co">##    <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>       <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>            <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>         <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>           <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>       </span>
<span class="co">## <span style="color: #BCBCBC;"> 1</span> MB-4189         3             61.0          355. DECEASED        Died of Oth…</span>
<span class="co">## <span style="color: #BCBCBC;"> 2</span> MB-4079         3             63.2          351  DECEASED        Died of Oth…</span>
<span class="co">## <span style="color: #BCBCBC;"> 3</span> MB-0270         1             30.0          337. LIVING          Living      </span>
<span class="co">## <span style="color: #BCBCBC;"> 4</span> MB-4235         3             67.5          336. DECEASED        Died of Dis…</span>
<span class="co">## <span style="color: #BCBCBC;"> 5</span> MB-4292         3             58.8          336. DECEASED        Died of Oth…</span>
<span class="co">## <span style="color: #BCBCBC;"> 6</span> MB-4212         3             45.5          330. LIVING          Living      </span>
<span class="co">## <span style="color: #BCBCBC;"> 7</span> MB-4548         3             50.4          323. LIVING          Living      </span>
<span class="co">## <span style="color: #BCBCBC;"> 8</span> MB-4633         3             67.0          318. LIVING          Living      </span>
<span class="co">## <span style="color: #BCBCBC;"> 9</span> MB-4332         3             34.4          308. LIVING          Living      </span>
<span class="co">## <span style="color: #BCBCBC;">10</span> MB-4418         3             56.1          308. LIVING          Living      </span>
<span class="co">## <span style="color: #949494;"># … with 1,894 more rows, and 27 more variables: Chemotherapy &lt;chr&gt;,</span></span>
<span class="co">## <span style="color: #949494;">#   Radiotherapy &lt;chr&gt;, Tumour_size &lt;dbl&gt;, Tumour_stage &lt;dbl&gt;,</span></span>
<span class="co">## <span style="color: #949494;">#   Neoplasm_histologic_grade &lt;dbl&gt;, Lymph_nodes_examined_positive &lt;dbl&gt;,</span></span>
<span class="co">## <span style="color: #949494;">#   Lymph_node_status &lt;dbl&gt;, Cancer_type &lt;chr&gt;, ER_status &lt;chr&gt;,</span></span>
<span class="co">## <span style="color: #949494;">#   PR_status &lt;chr&gt;, HER2_status &lt;chr&gt;, HER2_status_measured_by_SNP6 &lt;chr&gt;,</span></span>
<span class="co">## <span style="color: #949494;">#   PAM50 &lt;chr&gt;, `3-gene_classifier` &lt;chr&gt;, Nottingham_prognostic_index &lt;dbl&gt;,</span></span>
<span class="co">## <span style="color: #949494;">#   Cellularity &lt;chr&gt;, Integrative_cluster &lt;chr&gt;, Mutation_count &lt;dbl&gt;, …</span></span></code></pre>
<p>As with the other tidyverse functions and, in particular, the other 4
key dplyr ‘verbs’, <code><a href="https://dplyr.tidyverse.org/reference/arrange.html" class="external-link">arrange()</a></code> works rather well in workflows
in which successive operations are chained using
<code>%&gt;%</code>.</p>
<div class="sourceCode" id="cb61"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">patients_of_interest</span> <span class="op">&lt;-</span> <span class="va">metabric</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span>
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="va">Survival_status</span> <span class="op">==</span> <span class="st">"LIVING"</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span>
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="va">Survival_time</span> <span class="op">&gt;</span> <span class="fl">120</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span>
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html" class="external-link">select</a></span><span class="op">(</span><span class="va">Patient_ID</span>, <span class="va">Survival_time</span>, <span class="va">Tumour_stage</span>, <span class="va">Nottingham_prognostic_index</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span>
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/arrange.html" class="external-link">arrange</a></span><span class="op">(</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/desc.html" class="external-link">desc</a></span><span class="op">(</span><span class="va">Survival_time</span><span class="op">)</span><span class="op">)</span>
<span class="co"># print out the result</span>
<span class="va">patients_of_interest</span></code></pre></div>
<pre><code><span class="co">## <span style="color: #949494;"># A tibble: 545 × 4</span></span>
<span class="co">##    Patient_ID Survival_time Tumour_stage Nottingham_prognostic_index</span>
<span class="co">##    <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>              <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>        <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>                       <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span></span>
<span class="co">## <span style="color: #BCBCBC;"> 1</span> MB-0270             337.            2                        4.03</span>
<span class="co">## <span style="color: #BCBCBC;"> 2</span> MB-4212             330.           <span style="color: #BB0000;">NA</span>                        3.04</span>
<span class="co">## <span style="color: #BCBCBC;"> 3</span> MB-4548             323.            2                        5.00</span>
<span class="co">## <span style="color: #BCBCBC;"> 4</span> MB-4633             318.            2                        5.05</span>
<span class="co">## <span style="color: #BCBCBC;"> 5</span> MB-4332             308.            1                        4.04</span>
<span class="co">## <span style="color: #BCBCBC;"> 6</span> MB-4418             308.            1                        3.04</span>
<span class="co">## <span style="color: #BCBCBC;"> 7</span> MB-6021             301.           <span style="color: #BB0000;">NA</span>                        3   </span>
<span class="co">## <span style="color: #BCBCBC;"> 8</span> MB-4702             301.            2                        4.07</span>
<span class="co">## <span style="color: #BCBCBC;"> 9</span> MB-4839             299.           <span style="color: #BB0000;">NA</span>                        1.02</span>
<span class="co">## <span style="color: #BCBCBC;">10</span> MB-4735             298.            2                        3.08</span>
<span class="co">## <span style="color: #949494;"># … with 535 more rows</span></span></code></pre>
<p>We can sort by more than one variable by adding more variable
arguments to <code><a href="https://dplyr.tidyverse.org/reference/arrange.html" class="external-link">arrange()</a></code>.</p>
<div class="sourceCode" id="cb63"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://dplyr.tidyverse.org/reference/arrange.html" class="external-link">arrange</a></span><span class="op">(</span><span class="va">patients_of_interest</span>, <span class="va">Tumour_stage</span>, <span class="va">Nottingham_prognostic_index</span><span class="op">)</span></code></pre></div>
<pre><code><span class="co">## <span style="color: #949494;"># A tibble: 545 × 4</span></span>
<span class="co">##    Patient_ID Survival_time Tumour_stage Nottingham_prognostic_index</span>
<span class="co">##    <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>              <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>        <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>                       <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span></span>
<span class="co">## <span style="color: #BCBCBC;"> 1</span> MB-0230             200.            0                        1.07</span>
<span class="co">## <span style="color: #BCBCBC;"> 2</span> MB-5186             203.            1                        1.02</span>
<span class="co">## <span style="color: #BCBCBC;"> 3</span> MB-0245             165.            1                        1.03</span>
<span class="co">## <span style="color: #BCBCBC;"> 4</span> MB-0318             169.            1                        1.04</span>
<span class="co">## <span style="color: #BCBCBC;"> 5</span> MB-3797             228.            1                        1.05</span>
<span class="co">## <span style="color: #BCBCBC;"> 6</span> MB-4897             197.            1                        2.00</span>
<span class="co">## <span style="color: #BCBCBC;"> 7</span> MB-2721             252.            1                        2.02</span>
<span class="co">## <span style="color: #BCBCBC;"> 8</span> MB-0275             186.            1                        2.02</span>
<span class="co">## <span style="color: #BCBCBC;"> 9</span> MB-2564             285.            1                        2.02</span>
<span class="co">## <span style="color: #BCBCBC;">10</span> MB-0244             150.            1                        2.02</span>
<span class="co">## <span style="color: #949494;"># … with 535 more rows</span></span></code></pre>
<p>Here we’ve sorted first by tumour stage from lowest to highest value
and then by the Nottingham prognostic index for when there are ties,
i.e. where the tumour stage is the same.</p>
<p>Sorting is most commonly used in workflows as one of the last steps
before printing out a data frame or writing out the table to a file.</p>
<hr>
</div>
<div class="section level2">
<h2 id="modifying-data-using-mutate">Modifying data using <code>mutate()</code><a class="anchor" aria-label="anchor" href="#modifying-data-using-mutate"></a>
</h2>
<p>In one of the examples of filtering observations using
<code><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter()</a></code> above, we created a new logical variable called
<code>Deceased</code>.</p>
<div class="sourceCode" id="cb65"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">metabric</span><span class="op">$</span><span class="va">Deceased</span> <span class="op">&lt;-</span> <span class="va">metabric</span><span class="op">$</span><span class="va">Survival_status</span> <span class="op">==</span> <span class="st">"DECEASED"</span></code></pre></div>
<p>This is an example of a rather common type of data manipulation in
which we create a new column based on the values contained in one or
more other columns. The <code>dplyr</code> package provides the
<code><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate()</a></code> function for this purpose.</p>
<div class="sourceCode" id="cb66"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">metabric</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span><span class="va">metabric</span>, Deceased <span class="op">=</span> <span class="va">Survival_status</span> <span class="op">==</span> <span class="st">"DECEASED"</span><span class="op">)</span></code></pre></div>
<p>Both of these methods add the new column to the end.</p>
<p>Note that variables names in the <code><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate()</a></code> function call
do not need to be prefixed by <code>metabric$</code> just as they don’t
in any of the <code>dplyr</code> functions.</p>
<p>We can overwrite a column and this is quite commonly done when we
want to change the units. For example, our tumour size values are in
millimetres but the formula for the Nottingham prognostic index needs
the tumour size to be in centimetres. We can convert to
<code>Tumour_size</code> to centimetres by dividing by 10.</p>
<div class="sourceCode" id="cb67"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">metabric</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span><span class="va">metabric</span>, Tumour_size <span class="op">=</span> <span class="va">Tumour_size</span> <span class="op">/</span> <span class="fl">10</span><span class="op">)</span></code></pre></div>
<div class="rmdblock">
<p>
<strong>Nottingham Prognostic Index</strong>
</p>
<p>
The Nottingham prognostic index (<strong>NPI</strong>) is used to
determine prognosis following surgery for breast cancer. Its value is
calculated using three pathological criteria: the size of the tumour,
the number of lymph nodes involved, and the grade of the tumour.
</p>
<p>
The formula for the Nottingham prognostic index is:
</p>
<p>
<strong><code>NPI = (0.2 * S) + N + G</code></strong>
</p>
<p>
where
</p>
<ul>
<li>
<strong>S</strong> is the size of the tumour in centimetres
</li>
<li>
<strong>N</strong> is the node status (0 nodes = 1, 1-3 nodes = 2, &gt;3
nodes = 3)
</li>
<li>
<strong>G</strong> is the grade of tumour (Grade I = 1, Grade II = 2,
Grade III = 3)
</li>
</ul>
</div>
<p>We’ll recalculate the Nottingham prognostic index using the values
<code>Tumour_size</code>, <code>Neoplasm_histologic_grade</code> and
<code>Lymph_node_status</code> columns in our METABRIC data frame.</p>
<div class="sourceCode" id="cb68"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">metabric</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span><span class="va">metabric</span>, NPI <span class="op">=</span> <span class="fl">0.2</span> <span class="op">*</span> <span class="va">Tumour_size</span> <span class="op">+</span> <span class="va">Lymph_node_status</span> <span class="op">+</span> <span class="va">Neoplasm_histologic_grade</span><span class="op">)</span>

<span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html" class="external-link">select</a></span><span class="op">(</span><span class="va">metabric</span>, <span class="va">Tumour_size</span>, <span class="va">Lymph_node_status</span>, <span class="va">Neoplasm_histologic_grade</span>, <span class="va">NPI</span>, <span class="va">Nottingham_prognostic_index</span><span class="op">)</span></code></pre></div>
<pre><code><span class="co">## <span style="color: #949494;"># A tibble: 1,904 × 5</span></span>
<span class="co">##    Tumour_size Lymph_node_status Neoplasm_histologic_gra…   NPI Nottingham_prog…</span>
<span class="co">##          <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>             <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>                    <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>            <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span></span>
<span class="co">## <span style="color: #BCBCBC;"> 1</span>         2.2                 3                        3  6.44             6.04</span>
<span class="co">## <span style="color: #BCBCBC;"> 2</span>         1                   1                        3  4.2              4.02</span>
<span class="co">## <span style="color: #BCBCBC;"> 3</span>         1.5                 2                        2  4.3              4.03</span>
<span class="co">## <span style="color: #BCBCBC;"> 4</span>         2.5                 2                        2  4.5              4.05</span>
<span class="co">## <span style="color: #BCBCBC;"> 5</span>         4                   3                        3  6.8              6.08</span>
<span class="co">## <span style="color: #BCBCBC;"> 6</span>         3.1                 1                        3  4.62             4.06</span>
<span class="co">## <span style="color: #BCBCBC;"> 7</span>         1                   2                        2  4.2              4.02</span>
<span class="co">## <span style="color: #BCBCBC;"> 8</span>         2.9                 2                        2  4.58             4.06</span>
<span class="co">## <span style="color: #BCBCBC;"> 9</span>         1.6                 2                        3  5.32             5.03</span>
<span class="co">## <span style="color: #BCBCBC;">10</span>         2.8                 1                        2  3.56             3.06</span>
<span class="co">## <span style="color: #949494;"># … with 1,894 more rows</span></span></code></pre>
<p>There is a discrepency. Can you see what the problem is?</p>
<p>It appears that the tumour size wasn’t correctly converted into
centimetres in the original NPI calculation or that the wrong scaling
factor for tumour size was used. This could explain why the plots we
created in weeks 1 and 2 featuring the Nottingham prognostic index
looked so odd. We’ll see if they look any better with our recalculated
values.</p>
<div class="sourceCode" id="cb70"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span>data <span class="op">=</span> <span class="va">metabric</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_point.html" class="external-link">geom_point</a></span><span class="op">(</span>mapping <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">Age_at_diagnosis</span>, y <span class="op">=</span> <span class="va">NPI</span><span class="op">)</span>, na.rm <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></code></pre></div>
<p><img src="week3_files/figure-html/scatter_plot_1-1.png" width="700"></p>
<p>There is still some banding but nothing like the NPI values
downloaded from cBioPortal which line up very closely to whole
numbers.</p>
<p>The <strong><code><a href="https://rdrr.io/r/base/Round.html" class="external-link">round()</a></code></strong> function is really useful
for rounding numerical values to a specified number of decimal places.
We’ll read in the METABRIC data again and create a small workflow that
carries out the tumour size conversion, computes the NPI, rounds the
tumour size and the resulting NPI value to 1 decimal place and displays
the results in decreasing order of NPI.</p>
<div class="sourceCode" id="cb71"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://readr.tidyverse.org/reference/read_delim.html" class="external-link">read_csv</a></span><span class="op">(</span><span class="st">"https://zenodo.org/record/6450144/files/metabric_clinical_and_expression_data.csv"</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span>
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span>Tumour_size <span class="op">=</span> <span class="va">Tumour_size</span> <span class="op">/</span> <span class="fl">10</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span>
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span>NPI <span class="op">=</span> <span class="fl">0.2</span> <span class="op">*</span> <span class="va">Tumour_size</span> <span class="op">+</span> <span class="va">Lymph_node_status</span> <span class="op">+</span> <span class="va">Neoplasm_histologic_grade</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span>
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span>Tumour_size <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/Round.html" class="external-link">round</a></span><span class="op">(</span><span class="va">Tumour_size</span>, digits <span class="op">=</span> <span class="fl">1</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span>
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span>NPI <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/Round.html" class="external-link">round</a></span><span class="op">(</span><span class="va">NPI</span>, digits <span class="op">=</span> <span class="fl">1</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span>
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/arrange.html" class="external-link">arrange</a></span><span class="op">(</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/desc.html" class="external-link">desc</a></span><span class="op">(</span><span class="va">NPI</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span>
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html" class="external-link">select</a></span><span class="op">(</span><span class="va">Tumour_size</span>, <span class="va">Lymph_node_status</span>, <span class="va">Neoplasm_histologic_grade</span>, <span class="va">NPI</span><span class="op">)</span></code></pre></div>
<pre><code><span class="co">## <span style="color: #949494;"># A tibble: 1,904 × 4</span></span>
<span class="co">##    Tumour_size Lymph_node_status Neoplasm_histologic_grade   NPI</span>
<span class="co">##          <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>             <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>                     <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span></span>
<span class="co">## <span style="color: #BCBCBC;"> 1</span>        18                   3                         3   9.6</span>
<span class="co">## <span style="color: #BCBCBC;"> 2</span>        16                   3                         3   9.2</span>
<span class="co">## <span style="color: #BCBCBC;"> 3</span>        15                   3                         3   9  </span>
<span class="co">## <span style="color: #BCBCBC;"> 4</span>        13                   3                         3   8.6</span>
<span class="co">## <span style="color: #BCBCBC;"> 5</span>        18.2                 2                         3   8.6</span>
<span class="co">## <span style="color: #BCBCBC;"> 6</span>        12                   3                         3   8.4</span>
<span class="co">## <span style="color: #BCBCBC;"> 7</span>        10                   3                         3   8  </span>
<span class="co">## <span style="color: #BCBCBC;"> 8</span>         9.9                 3                         3   8  </span>
<span class="co">## <span style="color: #BCBCBC;"> 9</span>         9.9                 3                         3   8  </span>
<span class="co">## <span style="color: #BCBCBC;">10</span>         8.4                 3                         3   7.7</span>
<span class="co">## <span style="color: #949494;"># … with 1,894 more rows</span></span></code></pre>
<div class="section level3">
<h3 id="mutating-multiple-columns">Mutating multiple columns<a class="anchor" aria-label="anchor" href="#mutating-multiple-columns"></a>
</h3>
<p>In that last workflow we included the same rounding operation applied
to two different variables. It would be nice to be able to carry out
just the one <code><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate()</a></code> but apply it to both
<code>Tumour_size</code> and <code>NPI</code> columns and we can using
<strong><code><a href="https://dplyr.tidyverse.org/reference/across.html" class="external-link">across()</a></code></strong> inside <code><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate()</a></code>.
This allows us to apply a function across multiple columns.</p>
<div class="sourceCode" id="cb73"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">metabric</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span>
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/across.html" class="external-link">across</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="va">Tumour_size</span>, <span class="va">NPI</span><span class="op">)</span>, <span class="va">round</span>, digits <span class="op">=</span> <span class="fl">1</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span>
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html" class="external-link">select</a></span><span class="op">(</span><span class="va">Patient_ID</span>, <span class="va">Tumour_size</span>, <span class="va">NPI</span><span class="op">)</span></code></pre></div>
<pre><code><span class="co">## <span style="color: #949494;"># A tibble: 1,904 × 3</span></span>
<span class="co">##    Patient_ID Tumour_size   NPI</span>
<span class="co">##    <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>            <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span></span>
<span class="co">## <span style="color: #BCBCBC;"> 1</span> MB-0000            2.2   6.4</span>
<span class="co">## <span style="color: #BCBCBC;"> 2</span> MB-0002            1     4.2</span>
<span class="co">## <span style="color: #BCBCBC;"> 3</span> MB-0005            1.5   4.3</span>
<span class="co">## <span style="color: #BCBCBC;"> 4</span> MB-0006            2.5   4.5</span>
<span class="co">## <span style="color: #BCBCBC;"> 5</span> MB-0008            4     6.8</span>
<span class="co">## <span style="color: #BCBCBC;"> 6</span> MB-0010            3.1   4.6</span>
<span class="co">## <span style="color: #BCBCBC;"> 7</span> MB-0014            1     4.2</span>
<span class="co">## <span style="color: #BCBCBC;"> 8</span> MB-0022            2.9   4.6</span>
<span class="co">## <span style="color: #BCBCBC;"> 9</span> MB-0028            1.6   5.3</span>
<span class="co">## <span style="color: #BCBCBC;">10</span> MB-0035            2.8   3.6</span>
<span class="co">## <span style="color: #949494;"># … with 1,894 more rows</span></span></code></pre>
<p>This is slightly more complicated. Inside <code><a href="https://dplyr.tidyverse.org/reference/across.html" class="external-link">across()</a></code> we
had to group the variables for which we want the function to apply using
<code><a href="https://rdrr.io/r/base/c.html" class="external-link">c()</a></code>. We then gave the function name as the next argument
and finally any additional arguments that the function needs, in this
case the number of digits.</p>
<p>We can use the range operator and the same helper functions as we did
for selecting columns using <code><a href="https://dplyr.tidyverse.org/reference/select.html" class="external-link">select()</a></code> inside
<code><a href="https://dplyr.tidyverse.org/reference/across.html" class="external-link">across()</a></code>.</p>
<p>For example, we might decide that our expression values are given to
a much higher degree of precision than is strictly necessary.</p>
<div class="sourceCode" id="cb75"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">metabric</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span>
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/across.html" class="external-link">across</a></span><span class="op">(</span><span class="va">ESR1</span><span class="op">:</span><span class="va">MLPH</span>, <span class="va">round</span>, digits <span class="op">=</span> <span class="fl">2</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span>
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html" class="external-link">select</a></span><span class="op">(</span><span class="va">Patient_ID</span>, <span class="va">ESR1</span><span class="op">:</span><span class="va">MLPH</span><span class="op">)</span></code></pre></div>
<pre><code><span class="co">## <span style="color: #949494;"># A tibble: 1,904 × 9</span></span>
<span class="co">##    Patient_ID  ESR1 ERBB2   PGR  TP53 PIK3CA GATA3 FOXA1  MLPH</span>
<span class="co">##    <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>      <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>  <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span></span>
<span class="co">## <span style="color: #BCBCBC;"> 1</span> MB-0000     8.93  9.33  5.68  6.34   5.7   6.93  7.95  9.73</span>
<span class="co">## <span style="color: #BCBCBC;"> 2</span> MB-0002    10.0   9.73  7.51  6.19   5.76 11.2  11.8  12.5 </span>
<span class="co">## <span style="color: #BCBCBC;"> 3</span> MB-0005    10.0   9.73  7.38  6.4    6.75  9.29 11.7  10.3 </span>
<span class="co">## <span style="color: #BCBCBC;"> 4</span> MB-0006    10.4  10.3   6.82  6.87   7.22  8.67 11.9  10.5 </span>
<span class="co">## <span style="color: #BCBCBC;"> 5</span> MB-0008    11.3   9.96  7.33  6.34   5.82  9.72 11.6  12.2 </span>
<span class="co">## <span style="color: #BCBCBC;"> 6</span> MB-0010    11.2   9.74  5.95  5.42   6.12  9.79 12.1  11.4 </span>
<span class="co">## <span style="color: #BCBCBC;"> 7</span> MB-0014    10.8   9.28  7.72  5.99   7.48  8.37 11.5  10.8 </span>
<span class="co">## <span style="color: #BCBCBC;"> 8</span> MB-0022    10.4   8.61  5.59  6.17   7.59  7.87 10.7   9.95</span>
<span class="co">## <span style="color: #BCBCBC;"> 9</span> MB-0028    12.5  10.7   5.33  6.22   6.25 10.3  12.2  10.9 </span>
<span class="co">## <span style="color: #BCBCBC;">10</span> MB-0035     7.54 11.5   5.59  6.41   5.99 10.2  12.8  13.5 </span>
<span class="co">## <span style="color: #949494;"># … with 1,894 more rows</span></span></code></pre>
<p>Or we could decide that all the columns whose names end with
“_status” are in fact categorical variables and should be converted to
factors.</p>
<div class="sourceCode" id="cb77"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">metabric</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span>
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/across.html" class="external-link">across</a></span><span class="op">(</span><span class="fu"><a href="https://tidyselect.r-lib.org/reference/starts_with.html" class="external-link">ends_with</a></span><span class="op">(</span><span class="st">"_status"</span><span class="op">)</span>, <span class="va">as.factor</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span>
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html" class="external-link">select</a></span><span class="op">(</span><span class="va">Patient_ID</span>, <span class="fu"><a href="https://tidyselect.r-lib.org/reference/starts_with.html" class="external-link">ends_with</a></span><span class="op">(</span><span class="st">"_status"</span><span class="op">)</span><span class="op">)</span></code></pre></div>
<pre><code><span class="co">## <span style="color: #949494;"># A tibble: 1,904 × 7</span></span>
<span class="co">##    Patient_ID Survival_status Vital_status  Lymph_node_stat… ER_status PR_status</span>
<span class="co">##    <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>      <span style="color: #949494; font-style: italic;">&lt;fct&gt;</span>           <span style="color: #949494; font-style: italic;">&lt;fct&gt;</span>         <span style="color: #949494; font-style: italic;">&lt;fct&gt;</span>            <span style="color: #949494; font-style: italic;">&lt;fct&gt;</span>     <span style="color: #949494; font-style: italic;">&lt;fct&gt;</span>    </span>
<span class="co">## <span style="color: #BCBCBC;"> 1</span> MB-0000    LIVING          Living        3                Positive  Negative </span>
<span class="co">## <span style="color: #BCBCBC;"> 2</span> MB-0002    LIVING          Living        1                Positive  Positive </span>
<span class="co">## <span style="color: #BCBCBC;"> 3</span> MB-0005    DECEASED        Died of Dise… 2                Positive  Positive </span>
<span class="co">## <span style="color: #BCBCBC;"> 4</span> MB-0006    LIVING          Living        2                Positive  Positive </span>
<span class="co">## <span style="color: #BCBCBC;"> 5</span> MB-0008    DECEASED        Died of Dise… 3                Positive  Positive </span>
<span class="co">## <span style="color: #BCBCBC;"> 6</span> MB-0010    DECEASED        Died of Dise… 1                Positive  Positive </span>
<span class="co">## <span style="color: #BCBCBC;"> 7</span> MB-0014    LIVING          Living        2                Positive  Positive </span>
<span class="co">## <span style="color: #BCBCBC;"> 8</span> MB-0022    DECEASED        Died of Othe… 2                Positive  Negative </span>
<span class="co">## <span style="color: #BCBCBC;"> 9</span> MB-0028    DECEASED        Died of Othe… 2                Positive  Negative </span>
<span class="co">## <span style="color: #BCBCBC;">10</span> MB-0035    DECEASED        Died of Dise… 1                Positive  Negative </span>
<span class="co">## <span style="color: #949494;"># … with 1,894 more rows, and 1 more variable: HER2_status &lt;fct&gt;</span></span></code></pre>
</div>
<div class="section level3">
<h3 id="anonymous-functions-advanced">Anonymous functions (ADVANCED)<a class="anchor" aria-label="anchor" href="#anonymous-functions-advanced"></a>
</h3>
<p>The <code>mutate</code> function with <code>across</code> is really
very powerful but with that comes additional complexity.</p>
<p>For example, we may come across situations where we’d like to apply
the same operation to multiple columns but where there is no available
function in R to do what we want.</p>
<p>Let’s say we want to convert the petal and sepal measurements in the
<code>iris</code> data set from centimetres to millimetres. We’d either
need to create a new function to do this conversion or we could use what
is known as an anonymous function, also known as a lambda
expression.</p>
<p>There is no ‘multiply by 10’ function and it seems a bit pointless to
create one just for this conversion so we’ll use an anonymous function
instead – anonymous because it has no name, it’s an <em>in situ</em>
function only used in our <code>mutate</code> with <code>across</code>
function call.</p>
<div class="sourceCode" id="cb79"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">iris</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span>
  <span class="fu"><a href="https://tibble.tidyverse.org/reference/as_tibble.html" class="external-link">as_tibble</a></span><span class="op">(</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span>
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/across.html" class="external-link">across</a></span><span class="op">(</span><span class="va">Sepal.Length</span><span class="op">:</span><span class="va">Petal.Width</span>, <span class="op">~</span> <span class="va">.</span> <span class="op">*</span> <span class="fl">10</span><span class="op">)</span><span class="op">)</span></code></pre></div>
<pre><code><span class="co">## <span style="color: #949494;"># A tibble: 150 × 5</span></span>
<span class="co">##    Sepal.Length Sepal.Width Petal.Length Petal.Width Species</span>
<span class="co">##           <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>       <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>        <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>       <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> <span style="color: #949494; font-style: italic;">&lt;fct&gt;</span>  </span>
<span class="co">## <span style="color: #BCBCBC;"> 1</span>           51          35           14           2 setosa </span>
<span class="co">## <span style="color: #BCBCBC;"> 2</span>           49          30           14           2 setosa </span>
<span class="co">## <span style="color: #BCBCBC;"> 3</span>           47          32           13           2 setosa </span>
<span class="co">## <span style="color: #BCBCBC;"> 4</span>           46          31           15           2 setosa </span>
<span class="co">## <span style="color: #BCBCBC;"> 5</span>           50          36           14           2 setosa </span>
<span class="co">## <span style="color: #BCBCBC;"> 6</span>           54          39           17           4 setosa </span>
<span class="co">## <span style="color: #BCBCBC;"> 7</span>           46          34           14           3 setosa </span>
<span class="co">## <span style="color: #BCBCBC;"> 8</span>           50          34           15           2 setosa </span>
<span class="co">## <span style="color: #BCBCBC;"> 9</span>           44          29           14           2 setosa </span>
<span class="co">## <span style="color: #BCBCBC;">10</span>           49          31           15           1 setosa </span>
<span class="co">## <span style="color: #949494;"># … with 140 more rows</span></span></code></pre>
<p>The <strong><code>~</code></strong> denotes that we’re using an
anonymous function (it is the symbol for formulae in R) and the
<code>.</code> is a placeholder for the column being operated on. In
this case, we’re multiplying each of the columns between
<code>Sepal.Length</code> and <code>Petal.Width</code> inclusive by
10.</p>
<p>If you think this is getting fairly complicated you’d be right. We’ll
leave it there for now but point you to vignette(“colwise”) if you’re
interested in finding out more information on how column-wise operations
with <code>across</code> work.</p>
<hr>
</div>
</div>
<div class="section level2">
<h2 id="computing-summary-values-using-summarise">Computing summary values using <code>summarise()</code><a class="anchor" aria-label="anchor" href="#computing-summary-values-using-summarise"></a>
</h2>
<p>We’ll cover the fifth of the main dplyr ‘verb’ functions,
<strong><code><a href="https://dplyr.tidyverse.org/reference/summarise.html" class="external-link">summarise()</a></code></strong>, only briefly here. This
function computes summary values for one or more variables (columns) in
a table. Here we will summarise values for the entire table but this
function is much more useful in combination with <code><a href="https://dplyr.tidyverse.org/reference/group_by.html" class="external-link">group_by()</a></code>
in working on groups of observations within the data set. We will look
at summarizing groups of observations next week.</p>
<p>Any function that calculates a single scalar value from a vector can
be used with <code><a href="https://dplyr.tidyverse.org/reference/summarise.html" class="external-link">summarise()</a></code>. For example, the
<code><a href="https://rdrr.io/r/base/mean.html" class="external-link">mean()</a></code> function calculates the arithmetic mean of a numeric
vector. Let’s calculate the average ESR1 expression for tumour samples
in the METABRIC data set.</p>
<div class="sourceCode" id="cb81"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/base/mean.html" class="external-link">mean</a></span><span class="op">(</span><span class="va">metabric</span><span class="op">$</span><span class="va">ESR1</span><span class="op">)</span></code></pre></div>
<pre><code><span class="co">## [1] 9.607824</span></code></pre>
<p>The equivalent operation using <code><a href="https://dplyr.tidyverse.org/reference/summarise.html" class="external-link">summarise()</a></code> is:</p>
<div class="sourceCode" id="cb83"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://dplyr.tidyverse.org/reference/summarise.html" class="external-link">summarise</a></span><span class="op">(</span><span class="va">metabric</span>, <span class="fu"><a href="https://rdrr.io/r/base/mean.html" class="external-link">mean</a></span><span class="op">(</span><span class="va">ESR1</span><span class="op">)</span><span class="op">)</span></code></pre></div>
<pre><code><span class="co">## <span style="color: #949494;"># A tibble: 1 × 1</span></span>
<span class="co">##   `mean(ESR1)`</span>
<span class="co">##          <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span></span>
<span class="co">## <span style="color: #BCBCBC;">1</span>         9.61</span></code></pre>
<p>If you prefer Oxford spelling, in which -ize is preferred to -ise,
you’re in luck as dplyr accommodates the alternative spelling.</p>
<p>Both of the above statements gave the same average expression value
but these were output in differing formats. The <code><a href="https://rdrr.io/r/base/mean.html" class="external-link">mean()</a></code>
function collapses a vector to single scalar value, which as we know is
in fact a vector of length 1. The <code><a href="https://dplyr.tidyverse.org/reference/summarise.html" class="external-link">summarise()</a></code> function, as
with most tidyverse functions, returns another data frame, albeit one in
which there is a single row and a single column.</p>
<p>Returning a data frame might be quite useful, particularly if we’re
summarising multiple columns or using more than one function, for
example computing the average and standard deviation.</p>
<div class="sourceCode" id="cb85"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://dplyr.tidyverse.org/reference/summarise.html" class="external-link">summarise</a></span><span class="op">(</span><span class="va">metabric</span>, ESR1_mean <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/mean.html" class="external-link">mean</a></span><span class="op">(</span><span class="va">ESR1</span><span class="op">)</span>, ESR1_sd <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/sd.html" class="external-link">sd</a></span><span class="op">(</span><span class="va">ESR1</span><span class="op">)</span><span class="op">)</span></code></pre></div>
<pre><code><span class="co">## <span style="color: #949494;"># A tibble: 1 × 2</span></span>
<span class="co">##   ESR1_mean ESR1_sd</span>
<span class="co">##       <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>   <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span></span>
<span class="co">## <span style="color: #BCBCBC;">1</span>      9.61    2.13</span></code></pre>
<p>Notice how we also named the output columns in this last example.</p>
<div class="rmdblock">
<p>
<strong><code><a href="https://dplyr.tidyverse.org/reference/summarise.html" class="external-link">summarise()</a></code></strong>
</p>
<p>
<code><a href="https://dplyr.tidyverse.org/reference/summarise.html" class="external-link">summarise()</a></code> collapses a data frame into a single row by
calculating summary values of one or more of the columns.
</p>
<p>
It can take any function that takes a vector of values and returns a
single value. Some of the more useful functions include:
</p>
<ul>
<li>
Centre: <strong><code><a href="https://rdrr.io/r/base/mean.html" class="external-link">mean()</a></code></strong>,
<strong><code><a href="https://rdrr.io/r/stats/median.html" class="external-link">median()</a></code></strong>
</li>
<li>
Spread: <strong><code><a href="https://rdrr.io/r/stats/sd.html" class="external-link">sd()</a></code></strong>,
<strong><code><a href="https://rdrr.io/r/stats/mad.html" class="external-link">mad()</a></code></strong>
</li>
<li>
Range: <strong><code><a href="https://rdrr.io/r/base/Extremes.html" class="external-link">min()</a></code></strong>,
<strong><code><a href="https://rdrr.io/r/base/Extremes.html" class="external-link">max()</a></code></strong>,
<strong><code><a href="https://rdrr.io/r/stats/quantile.html" class="external-link">quantile()</a></code></strong>
</li>
<li>
Position: <strong><code><a href="https://dplyr.tidyverse.org/reference/nth.html" class="external-link">first()</a></code></strong>,
<strong><code><a href="https://dplyr.tidyverse.org/reference/nth.html" class="external-link">last()</a></code></strong>
</li>
<li>
Count: <strong><code><a href="https://dplyr.tidyverse.org/reference/context.html" class="external-link">n()</a></code></strong>
</li>
</ul>
<p>
Note the <code><a href="https://dplyr.tidyverse.org/reference/nth.html" class="external-link">first()</a></code>, <code><a href="https://dplyr.tidyverse.org/reference/nth.html" class="external-link">last()</a></code> and <code><a href="https://dplyr.tidyverse.org/reference/context.html" class="external-link">n()</a></code>
are only really useful when working on groups of observations using
<strong><code><a href="https://dplyr.tidyverse.org/reference/group_by.html" class="external-link">group_by()</a></code></strong>.
</p>
<p>
<strong><code><a href="https://dplyr.tidyverse.org/reference/context.html" class="external-link">n()</a></code></strong> is a special function that returns the
number of observations; it doesn’t take a vector argument, i.e. a
column.
</p>
</div>
<p>It is also possible to summarise using a function that takes more
than one value, i.e. from multiple columns. For example, we could
compute the correlation between the expression of FOXA1 and MLPH.</p>
<div class="sourceCode" id="cb87"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://dplyr.tidyverse.org/reference/summarise.html" class="external-link">summarise</a></span><span class="op">(</span><span class="va">metabric</span>, correlation <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/cor.html" class="external-link">cor</a></span><span class="op">(</span><span class="va">FOXA1</span>, <span class="va">MLPH</span><span class="op">)</span><span class="op">)</span></code></pre></div>
<pre><code><span class="co">## <span style="color: #949494;"># A tibble: 1 × 1</span></span>
<span class="co">##   correlation</span>
<span class="co">##         <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span></span>
<span class="co">## <span style="color: #BCBCBC;">1</span>       0.898</span></code></pre>
<div class="section level3">
<h3 id="summarizing-multiple-columns">Summarizing multiple columns<a class="anchor" aria-label="anchor" href="#summarizing-multiple-columns"></a>
</h3>
<p>Similar to <code><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate()</a></code>, <code><a href="https://dplyr.tidyverse.org/reference/summarise.html" class="external-link">summarise()</a></code> can be
used with <code><a href="https://dplyr.tidyverse.org/reference/across.html" class="external-link">across()</a></code>for applying the same summarization
function to multiple columns in a single operation.</p>
<p>Inside <code><a href="https://dplyr.tidyverse.org/reference/across.html" class="external-link">across()</a></code> we give the columns we want the function
to apply, followed by the function name. Selecting the columns is done
in the same way as for <code><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate()</a></code> with <code><a href="https://dplyr.tidyverse.org/reference/across.html" class="external-link">across()</a></code>,
whatever works for <code><a href="https://dplyr.tidyverse.org/reference/select.html" class="external-link">select()</a></code> e.g.<code><a href="https://rdrr.io/r/base/c.html" class="external-link">c()</a></code>,
<code>:</code>, <code><a href="https://tidyselect.r-lib.org/reference/starts_with.html" class="external-link">starts_with()</a></code>.</p>
<div class="sourceCode" id="cb89"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://dplyr.tidyverse.org/reference/summarise.html" class="external-link">summarise</a></span><span class="op">(</span><span class="va">metabric</span>, <span class="fu"><a href="https://dplyr.tidyverse.org/reference/across.html" class="external-link">across</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="va">FOXA1</span>, <span class="va">MLPH</span><span class="op">)</span>, <span class="va">mean</span><span class="op">)</span><span class="op">)</span></code></pre></div>
<pre><code><span class="co">## <span style="color: #949494;"># A tibble: 1 × 2</span></span>
<span class="co">##   FOXA1  MLPH</span>
<span class="co">##   <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span></span>
<span class="co">## <span style="color: #BCBCBC;">1</span>  10.8  11.4</span></code></pre>
<div class="sourceCode" id="cb91"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://dplyr.tidyverse.org/reference/summarise.html" class="external-link">summarise</a></span><span class="op">(</span><span class="va">metabric</span>, <span class="fu"><a href="https://dplyr.tidyverse.org/reference/across.html" class="external-link">across</a></span><span class="op">(</span><span class="va">ESR1</span><span class="op">:</span><span class="va">MLPH</span>, <span class="va">mean</span><span class="op">)</span><span class="op">)</span></code></pre></div>
<pre><code><span class="co">## <span style="color: #949494;"># A tibble: 1 × 8</span></span>
<span class="co">##    ESR1 ERBB2   PGR  TP53 PIK3CA GATA3 FOXA1  MLPH</span>
<span class="co">##   <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>  <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span></span>
<span class="co">## <span style="color: #BCBCBC;">1</span>  9.61  10.8  6.24  6.20   5.97  9.50  10.8  11.4</span></code></pre>
<p>You have to be careful with <code><a href="https://dplyr.tidyverse.org/reference/summarise.html" class="external-link">summarise()</a></code> and
<code><a href="https://dplyr.tidyverse.org/reference/across.html" class="external-link">across()</a></code> that all columns can be summarised with the given
summary function. For example, what happens if we try to compute an
average of a set of character values?</p>
<p>Note we can use <code><a href="https://tidyselect.r-lib.org/reference/everything.html" class="external-link">everything()</a></code> if we want to use across
with all columns.</p>
<div class="sourceCode" id="cb93"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://dplyr.tidyverse.org/reference/summarise.html" class="external-link">summarise</a></span><span class="op">(</span><span class="va">metabric</span>, <span class="fu"><a href="https://dplyr.tidyverse.org/reference/across.html" class="external-link">across</a></span><span class="op">(</span><span class="fu"><a href="https://tidyselect.r-lib.org/reference/everything.html" class="external-link">everything</a></span><span class="op">(</span><span class="op">)</span>, <span class="va">mean</span>, na.rm <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span><span class="op">)</span></code></pre></div>
<pre><code><span class="co">## Warning in mean.default(col, ...): argument is not numeric or logical: returning</span>
<span class="co">## NA</span>

<span class="co">## Warning in mean.default(col, ...): argument is not numeric or logical: returning</span>
<span class="co">## NA</span>

<span class="co">## Warning in mean.default(col, ...): argument is not numeric or logical: returning</span>
<span class="co">## NA</span>

<span class="co">## Warning in mean.default(col, ...): argument is not numeric or logical: returning</span>
<span class="co">## NA</span>

<span class="co">## Warning in mean.default(col, ...): argument is not numeric or logical: returning</span>
<span class="co">## NA</span>

<span class="co">## Warning in mean.default(col, ...): argument is not numeric or logical: returning</span>
<span class="co">## NA</span>

<span class="co">## Warning in mean.default(col, ...): argument is not numeric or logical: returning</span>
<span class="co">## NA</span>

<span class="co">## Warning in mean.default(col, ...): argument is not numeric or logical: returning</span>
<span class="co">## NA</span>

<span class="co">## Warning in mean.default(col, ...): argument is not numeric or logical: returning</span>
<span class="co">## NA</span>

<span class="co">## Warning in mean.default(col, ...): argument is not numeric or logical: returning</span>
<span class="co">## NA</span>

<span class="co">## Warning in mean.default(col, ...): argument is not numeric or logical: returning</span>
<span class="co">## NA</span>

<span class="co">## Warning in mean.default(col, ...): argument is not numeric or logical: returning</span>
<span class="co">## NA</span>

<span class="co">## Warning in mean.default(col, ...): argument is not numeric or logical: returning</span>
<span class="co">## NA</span>

<span class="co">## Warning in mean.default(col, ...): argument is not numeric or logical: returning</span>
<span class="co">## NA</span></code></pre>
<pre><code><span class="co">## <span style="color: #949494;"># A tibble: 1 × 34</span></span>
<span class="co">##   Patient_ID Cohort Age_at_diagnosis Survival_time Survival_status Vital_status</span>
<span class="co">##        <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>  <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>            <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>         <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>           <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>        <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span></span>
<span class="co">## <span style="color: #BCBCBC;">1</span>         <span style="color: #BB0000;">NA</span>   2.64             61.1          125.              <span style="color: #BB0000;">NA</span>           <span style="color: #BB0000;">NA</span></span>
<span class="co">## <span style="color: #949494;"># … with 28 more variables: Chemotherapy &lt;dbl&gt;, Radiotherapy &lt;dbl&gt;,</span></span>
<span class="co">## <span style="color: #949494;">#   Tumour_size &lt;dbl&gt;, Tumour_stage &lt;dbl&gt;, Neoplasm_histologic_grade &lt;dbl&gt;,</span></span>
<span class="co">## <span style="color: #949494;">#   Lymph_nodes_examined_positive &lt;dbl&gt;, Lymph_node_status &lt;dbl&gt;,</span></span>
<span class="co">## <span style="color: #949494;">#   Cancer_type &lt;dbl&gt;, ER_status &lt;dbl&gt;, PR_status &lt;dbl&gt;, HER2_status &lt;dbl&gt;,</span></span>
<span class="co">## <span style="color: #949494;">#   HER2_status_measured_by_SNP6 &lt;dbl&gt;, PAM50 &lt;dbl&gt;, `3-gene_classifier` &lt;dbl&gt;,</span></span>
<span class="co">## <span style="color: #949494;">#   Nottingham_prognostic_index &lt;dbl&gt;, Cellularity &lt;dbl&gt;,</span></span>
<span class="co">## <span style="color: #949494;">#   Integrative_cluster &lt;dbl&gt;, Mutation_count &lt;dbl&gt;, ESR1 &lt;dbl&gt;, ERBB2 &lt;dbl&gt;, …</span></span></code></pre>
<p>We get a lot of warning messages and <code>NA</code> values for those
columns for which computing an average does not make sense.</p>
<p><strong><code>where()</code></strong> can be used to select those
values for which a summarization function is appropriate, for example,
where the column is of type numeric.</p>
<div class="sourceCode" id="cb96"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://dplyr.tidyverse.org/reference/summarise.html" class="external-link">summarise</a></span><span class="op">(</span><span class="va">metabric</span>, <span class="fu"><a href="https://dplyr.tidyverse.org/reference/across.html" class="external-link">across</a></span><span class="op">(</span><span class="fu">where</span><span class="op">(</span><span class="va">is.numeric</span><span class="op">)</span>, <span class="va">mean</span>, na.rm <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span><span class="op">)</span></code></pre></div>
<pre><code><span class="co">## <span style="color: #949494;"># A tibble: 1 × 19</span></span>
<span class="co">##   Cohort Age_at_diagnosis Survival_time Tumour_size Tumour_stage</span>
<span class="co">##    <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>            <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>         <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>       <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>        <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span></span>
<span class="co">## <span style="color: #BCBCBC;">1</span>   2.64             61.1          125.        2.62         1.75</span>
<span class="co">## <span style="color: #949494;"># … with 14 more variables: Neoplasm_histologic_grade &lt;dbl&gt;,</span></span>
<span class="co">## <span style="color: #949494;">#   Lymph_nodes_examined_positive &lt;dbl&gt;, Lymph_node_status &lt;dbl&gt;,</span></span>
<span class="co">## <span style="color: #949494;">#   Nottingham_prognostic_index &lt;dbl&gt;, Mutation_count &lt;dbl&gt;, ESR1 &lt;dbl&gt;,</span></span>
<span class="co">## <span style="color: #949494;">#   ERBB2 &lt;dbl&gt;, PGR &lt;dbl&gt;, TP53 &lt;dbl&gt;, PIK3CA &lt;dbl&gt;, GATA3 &lt;dbl&gt;, FOXA1 &lt;dbl&gt;,</span></span>
<span class="co">## <span style="color: #949494;">#   MLPH &lt;dbl&gt;, NPI &lt;dbl&gt;</span></span></code></pre>
<p>It is possible to summarise using more than one function in which
case a list of functions needs to be provided.</p>
<div class="sourceCode" id="cb98"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://dplyr.tidyverse.org/reference/summarise.html" class="external-link">summarise</a></span><span class="op">(</span><span class="va">metabric</span>, <span class="fu"><a href="https://dplyr.tidyverse.org/reference/across.html" class="external-link">across</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="va">ESR1</span>, <span class="va">ERBB2</span>, <span class="va">PGR</span><span class="op">)</span>, <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="va">mean</span>, <span class="va">sd</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></code></pre></div>
<pre><code><span class="co">## <span style="color: #949494;"># A tibble: 1 × 6</span></span>
<span class="co">##   ESR1_1 ESR1_2 ERBB2_1 ERBB2_2 PGR_1 PGR_2</span>
<span class="co">##    <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>  <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>   <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>   <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span></span>
<span class="co">## <span style="color: #BCBCBC;">1</span>   9.61   2.13    10.8    1.36  6.24  1.02</span></code></pre>
<p>Pretty neat but I’m not sure about those column headings in the
output – fortunately we have some control over these.</p>
<div class="sourceCode" id="cb100"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://dplyr.tidyverse.org/reference/summarise.html" class="external-link">summarise</a></span><span class="op">(</span><span class="va">metabric</span>, <span class="fu"><a href="https://dplyr.tidyverse.org/reference/across.html" class="external-link">across</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="va">ESR1</span>, <span class="va">ERBB2</span>, <span class="va">PGR</span><span class="op">)</span>, <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>average <span class="op">=</span> <span class="va">mean</span>, stdev <span class="op">=</span> <span class="va">sd</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></code></pre></div>
<pre><code><span class="co">## <span style="color: #949494;"># A tibble: 1 × 6</span></span>
<span class="co">##   ESR1_average ESR1_stdev ERBB2_average ERBB2_stdev PGR_average PGR_stdev</span>
<span class="co">##          <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>      <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>         <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>       <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>       <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>     <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span></span>
<span class="co">## <span style="color: #BCBCBC;">1</span>         9.61       2.13          10.8        1.36        6.24      1.02</span></code></pre>
</div>
<div class="section level3">
<h3 id="anonymous-functions-advanced-1">Anonymous functions (ADVANCED)<a class="anchor" aria-label="anchor" href="#anonymous-functions-advanced-1"></a>
</h3>
<p>The <code>mutate</code> and <code>summarise</code> functions with
<code><a href="https://dplyr.tidyverse.org/reference/across.html" class="external-link">across()</a></code> work in a very similar manner, very much in line
with the coherent and consistent framework provided by
<code>dplyr</code> and the entire tidyverse. For example, we could use
an anonymous function with <code><a href="https://dplyr.tidyverse.org/reference/across.html" class="external-link">across()</a></code> in a
<code><a href="https://dplyr.tidyverse.org/reference/summarise.html" class="external-link">summarise()</a></code> operation to apply to multiple variables. In
the assignment from last week, we asked you to compute the correlation
of the expression for FOXA1 against all other genes to see which was
most strongly correlated. Here is how we could do this in a single
<code><a href="https://dplyr.tidyverse.org/reference/summarise.html" class="external-link">summarise()</a></code> statement using an anonymous function.</p>
<div class="sourceCode" id="cb102"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://dplyr.tidyverse.org/reference/summarise.html" class="external-link">summarise</a></span><span class="op">(</span><span class="va">metabric</span>, <span class="fu"><a href="https://dplyr.tidyverse.org/reference/across.html" class="external-link">across</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="va">ESR1</span><span class="op">:</span><span class="va">MLPH</span>, <span class="op">-</span><span class="va">FOXA1</span><span class="op">)</span>, <span class="op">~</span> <span class="fu"><a href="https://rdrr.io/r/stats/cor.html" class="external-link">cor</a></span><span class="op">(</span><span class="va">.</span>, <span class="va">FOXA1</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></code></pre></div>
<pre><code><span class="co">## <span style="color: #949494;"># A tibble: 1 × 7</span></span>
<span class="co">##    ESR1 ERBB2   PGR    TP53 PIK3CA GATA3  MLPH</span>
<span class="co">##   <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>   <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>  <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span></span>
<span class="co">## <span style="color: #BCBCBC;">1</span> 0.724 0.280 0.390 -<span style="color: #BB0000;">0.070</span><span style="color: #BB0000; text-decoration: underline;">0</span> -<span style="color: #BB0000;">0.149</span> 0.781 0.898</span></code></pre>
<p>Notice how we selected all genes between ESR1, the first gene column
in our data frame, and MLPH, the last gene column, but then excluded
FOXA1 as we’re not all that interested in the correlation of FOXA1 with
itself (we know the answer is 1).</p>
<hr>
</div>
</div>
<div class="section level2">
<h2 id="faceting-with-ggplot2">Faceting with ggplot2<a class="anchor" aria-label="anchor" href="#faceting-with-ggplot2"></a>
</h2>
<p>Finally, let’s change tack completely and take a look at a very
useful feature of ggplot2 – <strong>faceting</strong>.</p>
<p>Faceting allows you to split your plot into subplots, or facets,
based on one or more categorical variables. Each of the subplots
displays a subset of the data.</p>
<p>There are two faceting functions,
<strong><code><a href="https://ggplot2.tidyverse.org/reference/facet_wrap.html" class="external-link">facet_wrap()</a></code></strong> and
<strong><code><a href="https://ggplot2.tidyverse.org/reference/facet_grid.html" class="external-link">facet_grid()</a></code></strong>.</p>
<p>Let’s create a scatter plot of GATA3 and ESR1 expression values where
we’re displaying the PR positive and PR negative patients using
different colours. This is a very similar to a plot we created last
session</p>
<div class="sourceCode" id="cb104"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span>data <span class="op">=</span> <span class="va">metabric</span>, mapping <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">GATA3</span>, y <span class="op">=</span> <span class="va">ESR1</span>, colour <span class="op">=</span> <span class="va">PR_status</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_point.html" class="external-link">geom_point</a></span><span class="op">(</span>size <span class="op">=</span> <span class="fl">0.5</span>, alpha <span class="op">=</span> <span class="fl">0.5</span><span class="op">)</span></code></pre></div>
<p><img src="week3_files/figure-html/scatter_plot_2-1.png" width="700"></p>
<p>An alternative is to use faceting with
<strong><code><a href="https://ggplot2.tidyverse.org/reference/facet_wrap.html" class="external-link">facet_wrap()</a></code></strong>.</p>
<div class="sourceCode" id="cb105"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span>data <span class="op">=</span> <span class="va">metabric</span>, mapping <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">GATA3</span>, y <span class="op">=</span> <span class="va">ESR1</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_point.html" class="external-link">geom_point</a></span><span class="op">(</span>size <span class="op">=</span> <span class="fl">0.5</span>, alpha <span class="op">=</span> <span class="fl">0.5</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/facet_wrap.html" class="external-link">facet_wrap</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/vars.html" class="external-link">vars</a></span><span class="op">(</span><span class="va">PR_status</span><span class="op">)</span><span class="op">)</span></code></pre></div>
<p><img src="week3_files/figure-html/scatter_plot_3-1.png" width="700"></p>
<p>This produces two plots, side-by-side, one for each of the categories
in the <code>PR_status</code> variable, with a banner across the top of
each for the category.</p>
<p>The variable(s) used for faceting can be specified using
<code><a href="https://ggplot2.tidyverse.org/reference/vars.html" class="external-link">vars()</a></code>.</p>
<p>We can still use separate colours if we prefer things to be, well,
colourful.</p>
<div class="sourceCode" id="cb106"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span>data <span class="op">=</span> <span class="va">metabric</span>, mapping <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">GATA3</span>, y <span class="op">=</span> <span class="va">ESR1</span>, colour <span class="op">=</span> <span class="va">PR_status</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_point.html" class="external-link">geom_point</a></span><span class="op">(</span>size <span class="op">=</span> <span class="fl">0.5</span>, alpha <span class="op">=</span> <span class="fl">0.5</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/facet_wrap.html" class="external-link">facet_wrap</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/vars.html" class="external-link">vars</a></span><span class="op">(</span><span class="va">PR_status</span><span class="op">)</span><span class="op">)</span></code></pre></div>
<p><img src="week3_files/figure-html/scatter_plot_4-1.png" width="700"></p>
<p>Faceting is usually better than displaying groups using different
colours when there are more than two or three groups when it can be
difficult to really tell which points belong to each group. A case in
point is for the 3-gene classification in the GATA3 vs ESR1 scatter plot
we created last week. Let’s create a faceted version of that plot.</p>
<div class="sourceCode" id="cb107"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span>data <span class="op">=</span> <span class="va">metabric</span>, mapping <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">GATA3</span>, y <span class="op">=</span> <span class="va">ESR1</span>, colour <span class="op">=</span> <span class="va">`3-gene_classifier`</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_point.html" class="external-link">geom_point</a></span><span class="op">(</span>size <span class="op">=</span> <span class="fl">0.5</span>, alpha <span class="op">=</span> <span class="fl">0.5</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/facet_wrap.html" class="external-link">facet_wrap</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/vars.html" class="external-link">vars</a></span><span class="op">(</span><span class="va">`3-gene_classifier`</span><span class="op">)</span><span class="op">)</span></code></pre></div>
<p><img src="week3_files/figure-html/scatter_plot_5-1.png" width="700"></p>
<p>This helps explain why the function is called
<code><a href="https://ggplot2.tidyverse.org/reference/facet_wrap.html" class="external-link">facet_wrap()</a></code>. When it has too many subplots to fit across
the page, it wraps around to another row. We can control how many rows
or columns to use with the <code>nrow</code> and <code>ncol</code>
arguments.</p>
<div class="sourceCode" id="cb108"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span>data <span class="op">=</span> <span class="va">metabric</span>, mapping <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">GATA3</span>, y <span class="op">=</span> <span class="va">ESR1</span>, colour <span class="op">=</span> <span class="va">`3-gene_classifier`</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_point.html" class="external-link">geom_point</a></span><span class="op">(</span>size <span class="op">=</span> <span class="fl">0.5</span>, alpha <span class="op">=</span> <span class="fl">0.5</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/facet_wrap.html" class="external-link">facet_wrap</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/vars.html" class="external-link">vars</a></span><span class="op">(</span><span class="va">`3-gene_classifier`</span><span class="op">)</span>, nrow <span class="op">=</span> <span class="fl">1</span><span class="op">)</span></code></pre></div>
<p><img src="week3_files/figure-html/scatter_plot_6-1.png" width="700"></p>
<div class="sourceCode" id="cb109"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span>data <span class="op">=</span> <span class="va">metabric</span>, mapping <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">GATA3</span>, y <span class="op">=</span> <span class="va">ESR1</span>, colour <span class="op">=</span> <span class="va">`3-gene_classifier`</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_point.html" class="external-link">geom_point</a></span><span class="op">(</span>size <span class="op">=</span> <span class="fl">0.5</span>, alpha <span class="op">=</span> <span class="fl">0.5</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/facet_wrap.html" class="external-link">facet_wrap</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/vars.html" class="external-link">vars</a></span><span class="op">(</span><span class="va">`3-gene_classifier`</span><span class="op">)</span>, ncol <span class="op">=</span> <span class="fl">2</span><span class="op">)</span></code></pre></div>
<p><img src="week3_files/figure-html/scatter_plot_7-1.png" width="700"></p>
<p>We can combine faceting on one variable with a colour aesthetic for
another variable. For example, let’s show the tumour stage status using
faceting and the HER2 status using colours.</p>
<div class="sourceCode" id="cb110"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span>data <span class="op">=</span> <span class="va">metabric</span>, mapping <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">GATA3</span>, y <span class="op">=</span> <span class="va">ESR1</span>, colour <span class="op">=</span> <span class="va">HER2_status</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_point.html" class="external-link">geom_point</a></span><span class="op">(</span>size <span class="op">=</span> <span class="fl">0.5</span>, alpha <span class="op">=</span> <span class="fl">0.5</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/facet_wrap.html" class="external-link">facet_wrap</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/vars.html" class="external-link">vars</a></span><span class="op">(</span><span class="va">Neoplasm_histologic_grade</span><span class="op">)</span><span class="op">)</span></code></pre></div>
<p><img src="week3_files/figure-html/scatter_plot_8-1.png" width="700"></p>
<p>Instead of this we could facet on more than variable.</p>
<div class="sourceCode" id="cb111"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span>data <span class="op">=</span> <span class="va">metabric</span>, mapping <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">GATA3</span>, y <span class="op">=</span> <span class="va">ESR1</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_point.html" class="external-link">geom_point</a></span><span class="op">(</span>size <span class="op">=</span> <span class="fl">0.5</span>, alpha <span class="op">=</span> <span class="fl">0.5</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/facet_wrap.html" class="external-link">facet_wrap</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/vars.html" class="external-link">vars</a></span><span class="op">(</span><span class="va">Neoplasm_histologic_grade</span>, <span class="va">HER2_status</span><span class="op">)</span><span class="op">)</span></code></pre></div>
<p><img src="week3_files/figure-html/scatter_plot_9-1.png" width="700"></p>
<p>Faceting on two variables is usually better done using the other
faceting function, <strong><code><a href="https://ggplot2.tidyverse.org/reference/facet_grid.html" class="external-link">facet_grid()</a></code></strong>. Note the
change in how the formula is written.</p>
<div class="sourceCode" id="cb112"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span>data <span class="op">=</span> <span class="va">metabric</span>, mapping <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">GATA3</span>, y <span class="op">=</span> <span class="va">ESR1</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_point.html" class="external-link">geom_point</a></span><span class="op">(</span>size <span class="op">=</span> <span class="fl">0.5</span>, alpha <span class="op">=</span> <span class="fl">0.5</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/facet_grid.html" class="external-link">facet_grid</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/vars.html" class="external-link">vars</a></span><span class="op">(</span><span class="va">Neoplasm_histologic_grade</span><span class="op">)</span>, <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/vars.html" class="external-link">vars</a></span><span class="op">(</span><span class="va">HER2_status</span><span class="op">)</span><span class="op">)</span></code></pre></div>
<p><img src="week3_files/figure-html/scatter_plot_10-1.png" width="700"></p>
<p>Again we can use colour aesthetics alongside faceting to add further
information to our visualization.</p>
<div class="sourceCode" id="cb113"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span>data <span class="op">=</span> <span class="va">metabric</span>, mapping <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">GATA3</span>, y <span class="op">=</span> <span class="va">ESR1</span>, colour <span class="op">=</span> <span class="va">PAM50</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_point.html" class="external-link">geom_point</a></span><span class="op">(</span>size <span class="op">=</span> <span class="fl">0.5</span>, alpha <span class="op">=</span> <span class="fl">0.5</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/facet_grid.html" class="external-link">facet_grid</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/vars.html" class="external-link">vars</a></span><span class="op">(</span><span class="va">Neoplasm_histologic_grade</span><span class="op">)</span>, <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/vars.html" class="external-link">vars</a></span><span class="op">(</span><span class="va">HER2_status</span><span class="op">)</span><span class="op">)</span></code></pre></div>
<p><img src="week3_files/figure-html/scatter_plot_11-1.png" width="700"></p>
<p>Finally, we can use a <code>labeller</code> to change the labels for
each of the categorical values so that these are more meaningful in the
context of this plot.</p>
<div class="sourceCode" id="cb114"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">grade_labels</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"1"</span> <span class="op">=</span> <span class="st">"Grade I"</span>, <span class="st">"2"</span> <span class="op">=</span> <span class="st">"Grade II"</span>, <span class="st">"3"</span> <span class="op">=</span> <span class="st">"Grade III"</span><span class="op">)</span>
<span class="va">her2_status_labels</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"Positive"</span> <span class="op">=</span> <span class="st">"HER2 positive"</span>, <span class="st">"Negative"</span> <span class="op">=</span> <span class="st">"HER2 negative"</span><span class="op">)</span>
<span class="co">#</span>
<span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span>data <span class="op">=</span> <span class="va">metabric</span>, mapping <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">GATA3</span>, y <span class="op">=</span> <span class="va">ESR1</span>, colour <span class="op">=</span> <span class="va">PAM50</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_point.html" class="external-link">geom_point</a></span><span class="op">(</span>size <span class="op">=</span> <span class="fl">0.5</span>, alpha <span class="op">=</span> <span class="fl">0.5</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/facet_grid.html" class="external-link">facet_grid</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/vars.html" class="external-link">vars</a></span><span class="op">(</span><span class="va">Neoplasm_histologic_grade</span><span class="op">)</span>,
             <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/vars.html" class="external-link">vars</a></span><span class="op">(</span><span class="va">HER2_status</span><span class="op">)</span>,
             labeller <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labeller.html" class="external-link">labeller</a></span><span class="op">(</span>
               Neoplasm_histologic_grade <span class="op">=</span> <span class="va">grade_labels</span>,
               HER2_status <span class="op">=</span> <span class="va">her2_status_labels</span>
              <span class="op">)</span>
            <span class="op">)</span></code></pre></div>
<p><img src="week3_files/figure-html/scatter_plot_12-1.png" width="700"></p>
<p>This would certainly be necessary if we were to use ER and HER2
status on one side of the grid.</p>
<div class="sourceCode" id="cb115"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">er_status_labels</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"Positive"</span> <span class="op">=</span> <span class="st">"ER positive"</span>, <span class="st">"Negative"</span> <span class="op">=</span> <span class="st">"ER negative"</span><span class="op">)</span>
<span class="co">#</span>
<span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span>data <span class="op">=</span> <span class="va">metabric</span>, mapping <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">GATA3</span>, y <span class="op">=</span> <span class="va">ESR1</span>, colour <span class="op">=</span> <span class="va">PAM50</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_point.html" class="external-link">geom_point</a></span><span class="op">(</span>size <span class="op">=</span> <span class="fl">0.5</span>, alpha <span class="op">=</span> <span class="fl">0.5</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/facet_grid.html" class="external-link">facet_grid</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/vars.html" class="external-link">vars</a></span><span class="op">(</span><span class="va">Neoplasm_histologic_grade</span><span class="op">)</span>,
             <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/vars.html" class="external-link">vars</a></span><span class="op">(</span><span class="va">ER_status</span>, <span class="va">HER2_status</span><span class="op">)</span>,
             labeller <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labeller.html" class="external-link">labeller</a></span><span class="op">(</span>
               Neoplasm_histologic_grade <span class="op">=</span> <span class="va">grade_labels</span>,
               ER_status <span class="op">=</span> <span class="va">er_status_labels</span>,
               HER2_status <span class="op">=</span> <span class="va">her2_status_labels</span>
              <span class="op">)</span>
            <span class="op">)</span></code></pre></div>
<p><img src="week3_files/figure-html/scatter_plot_13-1.png" width="700"></p>
<hr>
</div>
<div class="section level2">
<h2 id="summary">Summary<a class="anchor" aria-label="anchor" href="#summary"></a>
</h2>
<p>In this session we have reviewed the following concepts:</p>
<ul>
<li>Filtering rows in a data frame based on their values</li>
<li>Selecting and reordering of columns</li>
<li>Sorting rows based on values in one or more columns</li>
<li>Modifying a data frame by either adding new columns or modifying
existing ones</li>
<li>Summarizing the values in one or more columns</li>
<li>Building up workflows by chaining operations together using the pipe
operator</li>
<li>Faceting of ggplot2 visualizations</li>
</ul>
<hr>
</div>
<div class="section level2">
<h2 id="assignment">Assignment<a class="anchor" aria-label="anchor" href="#assignment"></a>
</h2>
<p><a href="data:text/x-markdown;base64,Ci0tLQp0aXRsZTogIkFzc2lnbm1lbnQgMyIKLS0tCgpUaGUgd2VlaydzIGFzc2lnbm1lbnQgd2lsbCB0ZXN0IHlvdXIgYWJpbGl0eSB0byBtYW5pcHVsYXRlIHRoZSBNRVRBQlJJQyBkYXRhIHNldApieSBjaGFuZ2luZyB0aGUgdmFsdWVzIG9mIGV4aXN0aW5nIGNvbHVtbnMgb3IgYWRkaW5nIG5ldyBjb2x1bW5zIGJ5IGNvbXB1dGluZwpuZXcgdmFyaWFibGVzIGZyb20gZXhpc3Rpbmcgb25lcy4KCldlIGFyZSBleHBlY3RpbmcgeW91IHRvIHVzZSB0aGUgNSBtYWluIGRwbHlyICd2ZXJiJyBmdW5jdGlvbnM6IGBzZWxlY3QoKWAsCmBmaWx0ZXIoKWAsIGBhcnJhbmdlKClgLCBgbXV0YXRlKClgIGFuZCBgc3VtbWFyaXplKClgLiBQbGVhc2UgdXNlIHRoZSBwaXBlCm9wZXJhdG9yLCBgJT4lYCwgaW4gY2FzZXMgd2hlcmUgbW9yZSB0aGFuIG9uZSBvcGVyYXRpb24gaXMgcmVxdWlyZWQgdG8gYWNoaWV2ZQp0aGUgb3V0Y29tZSByZXF1ZXN0ZWQuCgpgYGB7ciBtZXNzYWdlID0gRkFMU0UsIHdhcm5pbmcgPSBGQUxTRX0KbGlicmFyeSh0aWR5dmVyc2UpCmBgYAoKYGBge3IgZXZhbCA9IEZBTFNFLCBtZXNzYWdlID0gRkFMU0UsIHdhcm5pbmcgPSBGQUxTRX0KbWV0YWJyaWMgPC0gcmVhZF9jc3YoImh0dHBzOi8vemVub2RvLm9yZy9yZWNvcmQvNjQ1MDE0NC9maWxlcy9tZXRhYnJpY19jbGluaWNhbF9hbmRfZXhwcmVzc2lvbl9kYXRhLmNzdiIpCmBgYAoKLS0tCgoqKjEuIEludmVzdGlnYXRlIHRoZSBzdWJzZXQgb2YgbG9uZy1zdXJ2aXZpbmcgYnJlYXN0IGNhbmNlciBwYXRpZW50cyB0aGF0IGRpZG4ndCByZWNlaXZlIGNoZW1vIG9yIHJhZGlvdGhlcmFweSoqCgpGaXJzdCBvYnRhaW4gdGhlIHN1YnNldCBvZiBwYXRpZW50cyB0aGF0IHJlY2VpdmVkIG5laXRoZXIgY2hlbW90aGVyYXB5IG9yCnJhZGlvdGhlcmFweSBhbmQgc3Vydml2ZWQgZm9yIG1vcmUgdGhhbiAyMCB5ZWFycy4KCmBgYHtyfQoKYGBgCgpOb3cgbG9vayBhdCB0aGUgYnJlYWtkb3duIG9mIHRoZXNlIHBhdGllbnRzIGluIHRlcm1zIG9mIEVSIHN0YXR1cy4gQ291bnQgdGhlCm51bWJlcnMgb2YgRVIgcG9zaXRpdmUgYW5kIEVSIG5lZ2F0aXZlIHBhdGllbnRzIGluIHRoaXMgc3Vic2V0LiBDYWxjdWxhdGUgdGhlCnByb3BvcnRpb24gdGhhdCBhcmUgRVIgcG9zaXRpdmUuCgpgYGB7cn0KCmBgYAoKV2hhdCBkb2VzIHRoaXMgdGVsbCB1cz8gQ2FsY3VsYXRlIHRoZSBwcm9wb3J0aW9uIG9mIEVSIHBvc2l0aXZlIHBhdGllbnRzIGluIHRoZQp3aG9sZSBjb2hvcnQgYnkgd2F5IG9mIGEgY29tcGFyaXNvbi4KCmBgYHtyfQoKYGBgCgotLS0KCioqMi4gV2hpY2ggcGF0aWVudHMgaGF2ZSBzcGVudCB0aGUgbGFyZ2VzdCBwcm9wb3J0aW9uIG9mIHRoZWlyIGxpdmVzIGRlYWxpbmcgd2l0aCBicmVhc3QgY2FuY2VyPyoqCgpgYGB7cn0KCmBgYAoKLS0tCgoqKjMuIENvbnZlcnQgdGhlIGV4cHJlc3Npb24gdmFsdWVzIGZvciBlYWNoIG9mIHRoZSBnZW5lcyBpbnRvIHN0YW5kYXJkaXplZCB6LXNjb3JlcyoqCgpTb21lIGdlbmVzIGFyZSBnZW5lcmFsbHkgZXhwcmVzc2VkIGF0IGhpZ2hlciBsZXZlbHMgdGhhbiBvdGhlcnMuIFRoaXMgY2FuIG1ha2UKY29tcGFyaXNvbnMgb2YgY2hhbmdlcyBiZXR3ZWVuIGdyb3VwcyBmb3IgYSBzZXQgb2YgZ2VuZXMgc29tZXdoYXQgZGlmZmljdWx0LApwYXJ0aWN1bGFybHkgaWYgdGhlIGV4cHJlc3Npb24gZm9yIHRob3NlIGdlbmVzIGFyZSBvbiB2ZXJ5IGRpZmZlcmVudCBzY2FsZXMuIFRoZQpleHByZXNzaW9uIHZhbHVlcyBpbiBvdXIgTUVUQUJSSUMgYXJlIG9uIGEgbG9nfjJ+IHNjYWxlIHdoaWNoIGhlbHBzIHRvIHJlZHVjZQp0aGUgcmFuZ2Ugb2YgdmFsdWVzIGJ1dCBhbm90aGVyIG1ldGhvZCBmb3IgcmVwcmVzZW50aW5nIGV4cHJlc3Npb24gbWVhc3VyZW1lbnRzCmlzIHRvIHN0YW5kYXJkaXplIHRoZXNlIHRvIHByb2R1Y2Ugei1zY29yZXMuCgpTdGFuZGFyZGl6YXRpb24gb2YgYSBzZXQgb2YgbWVhc3VyZW1lbnRzIGludm9sdmVzIHN1YnRyYWN0aW5nIHRoZSBtZWFuIGZyb20gZWFjaAphbmQgZGl2aWRpbmcgYnkgdGhlIHN0YW5kYXJkIGRldmlhdGlvbi4gVGhpcyB3aWxsIHByb2R1Y2UgdmFsdWVzIHdpdGggYSBtZWFuIG9mCjAgYW5kIGEgc3RhbmRhcmQgZGV2aWF0aW9uIG9mIDEuCgpDcmVhdGUgYSBtb2RpZmllZCB2ZXJzaW9uIG9mIHRoZSBgbWV0YWJyaWNgIGRhdGEgZnJhbWUgY29udGFpbmluZyBhIG5ldyBjb2x1bW4Kd2l0aCB0aGUgc3RhbmRhcmRpemVkIGV4cHJlc3Npb24gdmFsdWVzICh6LXNjb3JlcykgZm9yIHRoZSBFU1IxIGdlbmUuCgpgYGB7cn0KCmBgYAoKQ2hlY2sgdGhhdCB5b3UndmUgZG9uZSB0aGlzIGNvcnJlY3RseSBieSBjYWxjdWxhdGluZyB0aGUgbWVhbiBhbmQgc3RhbmRhcmQKZGV2aWF0aW9uIG9mIHlvdXIgbmV3IHotc2NvcmUgdmFyaWFibGUuCgpgYGB7cn0KCmBgYAoKQWRkIGFub3RoZXIgY29sdW1uIHRvIHlvdXIgbW9kaWZpZWQgYG1ldGFicmljYCBkYXRhIGZyYW1lIGNvbnRhaW5pbmcgYSB6LXNjb3JlCmZvciBHQVRBMyBhbmQgdGhlbiBjcmVhdGUgYSBzY2F0dGVyIHBsb3Qgb2YgdGhlIHotc2NvcmVzIG9mIEdBVEEzIGFnYWluc3QgRVNSMS4KTW9kaWZ5IHlvdXIgcGxvdCB0byBmYWNldCBieSB0aGUgUEFNNTAgY2xhc3NpZmljYXRpb24uCgpgYGB7cn0KCmBgYAoKKipFeHRlbnNpb24gMSoqCgpTdGFuZGFyZGl6ZSB0aGUgZXhwcmVzc2lvbiB2YWx1ZXMgZm9yIGFsbCBnZW5lcyBpbiBhIHNpbmdsZSBvcGVyYXRpb24gdXNpbmcgYW4KYW5vbnltb3VzIGZ1bmN0aW9uLCBvdmVyd3JpdGluZyB0aGVpciBvcmlnaW5hbCB2YWx1ZXMsIGFuZCByb3VuZCB0aGUgcmVzdWx0aW5nCnZhbHVlcyB0byAzIHNpZ25pZmljYW50IGZpZ3VyZXMuCgpgYGB7cn0KCmBgYAoKQ2hlY2sgeW91IGhhdmUgZG9uZSB0aGlzIGNvcnJlY3RseSBieSBjb21wdXRpbmcgdGhlIG1lYW4gYW5kIHN0YW5kYXJkIGRldmlhdGlvbiBmb3IKZWFjaCBjb2x1bW4sIGFnYWluIHVzaW5nIGEgc2luZ2xlIG9wZXJhdGlvbi4KCmBgYHtyfQoKYGBgCgpUbyBiZSBkb3VibHkgY2VydGFpbiwgeW91IGNvdWxkIGFsc28gZG93bmxvYWQgdGhlIGV4cHJlc3Npb24gei1zY29yZSB2YWx1ZXMgZm9yCnRoZXNlIGdlbmVzIGZyb20gY0Jpb1BvcnRhbC4KCioqRXh0ZW5zaW9uIDIqKgoKQ3JlYXRlIGEgcGxvdCBjb21wYXJpbmcgdGhlIGRpc3RyaWJ1dGlvbiBvZiBzdGFuZGFyZGl6ZWQgZXhwcmVzc2lvbiB2YWx1ZXMgZm9yClRQNTMgYWdhaW5zdCBhIG5vcm1hbCBkaXN0cmlidXRpb24uCgpgYGB7cn0KCmBgYAoKX0hpbnQ6IHVzZSBgc3RhdF9mdW5jdGlvbigpYF8KCi0tLQoKKio0LiBXaGljaCBTdGFyIFdhcnMgY2hhcmFjdGVycyBuZWVkIHRvIGdvIG9uIGEgZGlldD8qKgoKQ29tcHV0ZSB0aGUgYm9keSBtYXNzIGluZGV4IChCTUkpIG9mIGNoYXJhY3RlcnMgaW4gdGhlIGBzdGFyd2Fyc2AgdGliYmxlLiBUaGUgc3RhcndhcnMgZGF0YXNldCBpcyBwYXJ0IG9mIHRoZSBkcGx5ciBwYWNrYWdlIGFuZCBpcyBhdmFpbGFibGUgd2hlbiB5b3UgdXNlIGBsaWJyYXJ5KHRpZHl2ZXJzZSlgIG9yIGBsaWJyYXJ5KGRwbHlyKWAuIFRoZSBmb3JtdWxhIGZvciBCTUkgaXMga2cvbTIgd2hlcmUga2cgaXMgYSBwZXJzb24ncyB3ZWlnaHQgaW4ga2lsb2dyYW1zIGFuZCBtMiBpcyB0aGVpciBoZWlnaHQgaW4gbWV0cmVzIHNxdWFyZWQuCgpgYGB7cn0KCmBgYAoKRmlsdGVyIGZvciBodW1hbiBjaGFyYWN0ZXJzIHRoYXQgYXJlIG92ZXJ3ZWlnaHQgKEJNSSA+IDI1KSBhbmQgZGlzcGxheSBpbgpkZWNyZWFzaW5nIG9yZGVyIG9mIEJNSS4KCmBgYHtyfQoKYGBgCgo=" download="assignment3.Rmd">Download assignment3.Rmd</a></p>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">

        <nav id="toc" data-toggle="toc"><h2 data-toc-skip>Contents</h2>
    </nav>
</div>

</div>



      <footer><div class="copyright">
  <p></p>
<p>Developed by Maria Doyle.</p>
</div>

<div class="pkgdown">
  <p></p>
<p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.0.3.</p>
</div>

      </footer>
</div>

  


  

  </body>
</html>
